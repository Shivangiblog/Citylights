try{let a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},b=(new a.Error).stack;b&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[b]="d176d153-bb44-45b6-9228-4c7cb73fe16b",a._sentryDebugIdIdentifier="sentry-dbid-d176d153-bb44-45b6-9228-4c7cb73fe16b")}catch(a){}"use strict";exports.id=823,exports.ids=[823],exports.modules={10823:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{checkClaudeCodeAuthStatus:()=>p});var e=c(53025);c(33389);var f=c(6890),g=c(58833),h=c(74943),i=c(55511),j=c.n(i),k=c(49909),l=a([f,h]);[f,h]=l.then?(await l)():l;let t=null;async function m(){return t||(t=(await (0,g.S)()).claude),t}async function n(){try{let a=await m(),b=function(){let a=j().randomBytes(32).toString("base64url"),b=j().createHash("sha256").update(a).digest("base64url");return{verifier:a,challenge:b}}(),c=new URL(a.authorizeUrl);return c.searchParams.set("code","true"),c.searchParams.set("client_id",a.clientId),c.searchParams.set("response_type","code"),c.searchParams.set("redirect_uri",a.redirectUri),c.searchParams.set("scope","org:create_api_key user:profile user:inference"),c.searchParams.set("code_challenge",b.challenge),c.searchParams.set("code_challenge_method","S256"),c.searchParams.set("state",b.verifier),{success:!0,authUrl:c.toString(),verifier:b.verifier}}catch(a){return console.error("Error starting OAuth flow:",a),{success:!1,error:"Failed to start OAuth flow"}}}async function o(a,b){if(!a||!b)return{success:!1,error:"Missing code or verifier"};try{let c=await m(),d=a.split("#"),e=await fetch(c.tokenUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:d[0],state:d[1]||b,grant_type:"authorization_code",client_id:c.clientId,redirect_uri:c.redirectUri,code_verifier:b})});if(!e.ok){let a=await e.text();throw Error(`Failed to exchange code: ${a}`)}let f=await e.json(),g={type:"oauth",refresh:f.refresh_token,access:f.access_token,expires:Date.now()+1e3*f.expires_in};return h.FI.upsert({provider:"ClaudeCode",apikey:"",google_Oauth:JSON.stringify(g)}),{success:!0}}catch(a){return console.error("Error in OAuth callback:",a),{success:!1,error:a.message||"Failed to complete OAuth flow"}}}async function p(){try{let a=h.FI.getByProvider("ClaudeCode");if(!a?.google_Oauth)return{authenticated:!1};try{let b=JSON.parse(a.google_Oauth),c=b.expires&&b.expires>Date.now();return{authenticated:!0,tokenValid:c,expiresAt:b.expires}}catch(a){return console.error("Error parsing OAuth data:",a),{authenticated:!1}}}catch(a){return console.error("Error checking OAuth status:",a),{authenticated:!1}}}async function q(){try{return h.FI.delete("ClaudeCode"),{success:!0}}catch(a){return console.error("Error during logout:",a),{success:!1,error:"Failed to logout"}}}async function r(a){try{let b=await m(),c=await fetch(b.tokenUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"refresh_token",refresh_token:a.refresh,client_id:b.clientId})});if(!c.ok){let a=await c.text();throw(0,f.Vn)(JSON.stringify({refreshClaudeCodeTokenError:a},null,2)),Error(`Failed to refresh token: ${a}`)}let d=await c.json(),e={type:"oauth",refresh:d.refresh_token,access:d.access_token,expires:Date.now()+1e3*d.expires_in};return h.FI.upsert({provider:"ClaudeCode",apikey:"",google_Oauth:JSON.stringify(e)}),e}catch(a){return console.error("Error refreshing token:",a),null}}async function s(){let a=h.FI.getByProvider("ClaudeCode");if(!a?.google_Oauth)return null;try{let b=JSON.parse(a.google_Oauth);if(b.expires&&b.expires>Date.now())return b.access;if(b.refresh){let a=await r(b);if(a)return a.access}}catch(a){console.error("Error parsing OAuth data:",a)}return null}(0,k.D)([n,o,p,q,r,s]),(0,e.A)(n,"0003d7f45df6b0b2c347e50905a79d29b926511e1e",null),(0,e.A)(o,"608b321802ac55e003d268dc05a63910422c87ef53",null),(0,e.A)(p,"00f231cf88b395ee3f4c50240213ddbdcc5723fc65",null),(0,e.A)(q,"00a7100f947beb90bd3082dbd5c930d5716643ac07",null),(0,e.A)(r,"40b005237a307bf39bfc65d86e1ff31ae9b009bdf9",null),(0,e.A)(s,"0095dfe489c3eaad7529f40a37395096a069b66e3b",null),d()}catch(a){d(a)}})},58833:(a,b,c)=>{c.d(b,{S:()=>f});let d=null,e=null;async function f(){if(d)return d;if(e)return e;e=g();try{return d=await e}finally{e=null}}async function g(){try{let a=await fetch("https://storage.codegpt.co/vscode/keys.json",{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(1e4)});if(!a.ok)throw Error(`Failed to fetch OAuth config: ${a.status} ${a.statusText}`);let b=await a.json();return function(a){if(!a.gemini?.clientId||!a.gemini?.clientSecret)throw Error("Invalid OAuth config: missing Gemini credentials");if(!a.anthropic?.clientId)throw Error("Invalid OAuth config: missing Anthropic credentials");if(!a.claude?.clientId)throw Error("Invalid OAuth config: missing Claude credentials")}(b),b}catch(a){throw console.error("Failed to load OAuth configuration:",a),Error("Failed to load OAuth configuration from remote source")}}}};
//# sourceMappingURL=823.js.map