try{let a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},b=(new a.Error).stack;b&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[b]="158ee3b3-2e00-441d-916e-c55e0583c582",a._sentryDebugIdIdentifier="sentry-dbid-158ee3b3-2e00-441d-916e-c55e0583c582")}catch(a){}(()=>{var a={};a.id=9352,a.ids=[9352],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},1708:a=>{"use strict";a.exports=require("node:process")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8086:a=>{"use strict";a.exports=require("module")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:a=>{"use strict";a.exports=require("querystring")},11997:a=>{"use strict";a.exports=require("punycode")},12412:a=>{"use strict";a.exports=require("assert")},19063:a=>{"use strict";a.exports=require("require-in-the-middle")},19771:a=>{"use strict";a.exports=require("process")},21505:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{handler:()=>x,patchFetch:()=>w,routeModule:()=>y,serverHooks:()=>B,workAsyncStorage:()=>z,workUnitAsyncStorage:()=>A});var e=c(23501),f=c(4794),g=c(95321),h=c(90105),i=c(26443),j=c(261),k=c(40081),l=c(1983),m=c(91417),n=c(10282),o=c(51468),p=c(78326),q=c(95484),r=c(12829),s=c(86439),t=c(87747),u=c(34485),v=a([u]);u=(v.then?(await v)():v)[0];let y=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/[port]/api/(providers)/anthropic/route",pathname:"/[port]/api/anthropic",filename:"route",bundlePath:"app/[port]/api/(providers)/anthropic/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"C:\\Users\\USER\\Gian\\work\\codegpt-nextjs\\app\\[port]\\api\\(providers)\\anthropic\\route.ts",nextConfigOutput:"standalone",userland:u}),{workAsyncStorage:z,workUnitAsyncStorage:A,serverHooks:B}=y;function w(){return(0,g.patchFetch)({workAsyncStorage:z,workUnitAsyncStorage:A})}async function x(a,b,c){var d;let e="/[port]/api/(providers)/anthropic/route";"/index"===e&&(e="/");let g=await y.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:z,routerServerContext:A,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(z.dynamicRoutes[E]||z.routes[D]);if(F&&!x){let a=!!z.routes[D],b=z.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||y.isDev||x||(G=D,G="/index"===G?"/":G);let H=!0===y.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:z,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>y.onRequestError(a,b,d,A)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>y.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&B&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await y.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})},A),b}},l=await y.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:z,isRoutePPREnabled:!1,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",B?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(L||b instanceof s.NoFallbackError||await y.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}d()}catch(a){d(a)}})},21820:a=>{"use strict";a.exports=require("os")},25815:(a,b,c)=>{Promise.resolve().then(c.bind(c,96167))},27910:a=>{"use strict";a.exports=require("stream")},28354:a=>{"use strict";a.exports=require("util")},29021:a=>{"use strict";a.exports=require("fs")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31421:a=>{"use strict";a.exports=require("node:child_process")},33873:a=>{"use strict";a.exports=require("path")},34485:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{DELETE:()=>B,GET:()=>x,HEAD:()=>C,OPTIONS:()=>D,PATCH:()=>A,POST:()=>y,PUT:()=>z});var e=c(63033),f=c(43084),g=c(13234),h=c(69342),i=c(3708),j=c(25363),k=c(66936),l=c(54701),m=c(79321),n=c(6088),o=c(73294),p=c(14855),q=c(25009),r=a([f,g,h,i,l,n]);async function s(){return Response.json("",{status:g.FI.getByProvider("Anthropic")?.apikey?200:401})}async function t(a){let{messages:b}=await a.json();b=await (0,i.MP)({messages:b,provider:"Anthropic"}),"user"!==b[0].role&&(b=b.slice(1));let c=a.headers.get("model")||"claude-3-5-sonnet-20240620",d=a.headers.get("filePath"),e=a.headers.get("promptType"),q=await n.A.getLanguage(),r=await n.A.getIdeLanguage(),s=a.headers.get("fileName")??"",t="Chat",u=b[b.length-1],v=u?.codeSelection??"";if(e){t=e+"CodeGPT";let a=await (0,j.O)({promptType:e,cleanPromptText:u.content+v,language:r});a&&(b[b.length-1].content=a+u.content+v)}if(d){let a=JSON.stringify(await (0,f._P)(d),null,2);b[b.length-1].content+=`${d}

    ${a}`}let w=(0,m.O)(b.map(a=>a.content).join(""));try{let a=g.FI.getByProvider("Anthropic"),f=g.$W.getByProvider("Anthropic");if(!a?.apikey){let a=Error("You need to set your API key first.");throw a.status=401,a}let j=new o.Ay({apiKey:a?.apikey});b=(0,i.m6)(b);let n=await j.beta.messages.create({messages:b,model:c??"claude-2.1",stream:!0,max_tokens:2048,temperature:f?.temperature??.3}),r=(0,p.Ls)(n,{onFinal:async a=>{let b=(0,m.O)(a);await (0,h.U)({eventName:t,provider:"Anthropic",model:c??"claude-2",promptTokens:w,completionTokens:b,totalTokens:w+b,statusCode:200})}}),u=b.slice(0,-1).some(a=>a.content.includes(v));if(d||v&&(e||!u)){let a=await (0,l.sn)([`<p style='display: flex; align-items: center; gap: 0.5rem;'>${e?`<span class='command command-bordered command-with-icon' data-command='command'><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${e}</span></span>`:""}${s?`<span class='command command-bordered command-with-icon animate-slideIn relative h-auto items-center gap-1 overflow-hidden' data-id=${q} data-language=${q}><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${s}</span></span>`:""}${d?`<span class='command command-bordered command-with-icon animate-slideIn relative h-auto items-center gap-1 overflow-hidden' data-language=${d.split("/").pop()?.split(".").pop()}><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${d.split("/").pop()}</span></span>`:""}</p>

`],r);return new k.R(a)}return new k.R(r)}catch(a){return(0,h.U)({eventName:t,provider:"Anthropic",model:c,promptTokens:w,totalTokens:w,statusCode:a.status??500}),Response.json({message:a.message,status:a.status??500},{status:a.status??500})}}[f,g,h,i,l,n]=r.then?(await r)():r;let v={...e},w="workUnitAsyncStorage"in v?v.workUnitAsyncStorage:"requestAsyncStorage"in v?v.requestAsyncStorage:void 0;function u(a,b){return"phase-production-build"===process.env.NEXT_PHASE||"function"!=typeof a?a:new Proxy(a,{apply:(a,c,d)=>{let e;try{let a=w?.getStore();e=a?.headers}catch{}return q.wrapRouteHandlerWithSentry(a,{method:b,parameterizedRoute:"/[port]/api/(providers)/anthropic",headers:e}).apply(c,d)}})}let x=u(void 0,"GET"),y=u(t,"POST"),z=u(void 0,"PUT"),A=u(void 0,"PATCH"),B=u(void 0,"DELETE"),C=u(s,"HEAD"),D=u(void 0,"OPTIONS");d()}catch(a){d(a)}})},34631:a=>{"use strict";a.exports=require("tls")},36686:a=>{"use strict";a.exports=require("diagnostics_channel")},37067:a=>{"use strict";a.exports=require("node:http")},38522:a=>{"use strict";a.exports=require("node:zlib")},41692:a=>{"use strict";a.exports=require("node:tls")},44708:a=>{"use strict";a.exports=require("node:https")},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:a=>{"use strict";a.exports=require("node:os")},53053:a=>{"use strict";a.exports=require("node:diagnostics_channel")},54199:function(a,b){(function(a){"use strict";var b,c,d;function e(){}function f(a){return"object"==typeof a&&null!==a||"function"==typeof a}function g(a,b){try{Object.defineProperty(a,"name",{value:b,configurable:!0})}catch(a){}}let h=Promise,i=Promise.prototype.then,j=Promise.reject.bind(h);function k(a){return new h(a)}function l(a){return k(b=>b(a))}function m(a,b,c){return i.call(a,b,c)}function n(a,b,c){m(m(a,b,c),void 0,e)}function o(a,b){n(a,void 0,b)}function p(a){m(a,void 0,e)}let q=a=>{if("function"==typeof queueMicrotask)q=queueMicrotask;else{let a=l(void 0);q=b=>m(a,b)}return q(a)};function r(a,b,c){if("function"!=typeof a)throw TypeError("Argument is not a function");return Function.prototype.apply.call(a,b,c)}function s(a,b,c){try{return l(r(a,b,c))}catch(a){return j(a)}}class t{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(a){let b=this._back,c=b;16383===b._elements.length&&(c={_elements:[],_next:void 0}),b._elements.push(a),c!==b&&(this._back=c,b._next=c),++this._size}shift(){let a=this._front,b=a,c=this._cursor,d=c+1,e=a._elements,f=e[c];return 16384===d&&(b=a._next,d=0),--this._size,this._cursor=d,a!==b&&(this._front=b),e[c]=void 0,f}forEach(a){let b=this._cursor,c=this._front,d=c._elements;for(;(b!==d.length||void 0!==c._next)&&(b!==d.length||(d=(c=c._next)._elements,b=0,0!==d.length));)a(d[b]),++b}peek(){let a=this._front,b=this._cursor;return a._elements[b]}}let u=Symbol("[[AbortSteps]]"),v=Symbol("[[ErrorSteps]]"),w=Symbol("[[CancelSteps]]"),x=Symbol("[[PullSteps]]"),y=Symbol("[[ReleaseSteps]]");function z(a,b){var c,d,e;a._ownerReadableStream=b,b._reader=a,"readable"===b._state?D(a):"closed"===b._state?(D(c=a),F(c)):(d=a,e=b._storedError,D(d),E(d,e))}function A(a,b){return b1(a._ownerReadableStream,b)}function B(a){let b=a._ownerReadableStream;"readable"===b._state?E(a,TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):function(a,b){D(a),E(a,b)}(a,TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),b._readableStreamController[y](),b._reader=void 0,a._ownerReadableStream=void 0}function C(a){return TypeError("Cannot "+a+" a stream using a released reader")}function D(a){a._closedPromise=k((b,c)=>{a._closedPromise_resolve=b,a._closedPromise_reject=c})}function E(a,b){void 0!==a._closedPromise_reject&&(p(a._closedPromise),a._closedPromise_reject(b),a._closedPromise_resolve=void 0,a._closedPromise_reject=void 0)}function F(a){void 0!==a._closedPromise_resolve&&(a._closedPromise_resolve(void 0),a._closedPromise_resolve=void 0,a._closedPromise_reject=void 0)}let G=Number.isFinite||function(a){return"number"==typeof a&&isFinite(a)},H=Math.trunc||function(a){return a<0?Math.ceil(a):Math.floor(a)};function I(a,b){if(void 0!==a&&"object"!=typeof a&&"function"!=typeof a)throw TypeError(`${b} is not an object.`)}function J(a,b){if("function"!=typeof a)throw TypeError(`${b} is not a function.`)}function K(a,b){if(("object"!=typeof a||null===a)&&"function"!=typeof a)throw TypeError(`${b} is not an object.`)}function L(a,b,c){if(void 0===a)throw TypeError(`Parameter ${b} is required in '${c}'.`)}function M(a,b,c){if(void 0===a)throw TypeError(`${b} is required in '${c}'.`)}function N(a){return Number(a)}function O(a,b){var c,d;let e=Number.MAX_SAFE_INTEGER,f=Number(a);if(!G(f=0===(c=f)?0:c))throw TypeError(`${b} is not a finite number`);if((f=0===(d=H(f))?0:d)<0||f>e)throw TypeError(`${b} is outside the accepted range of 0 to ${e}, inclusive`);return G(f)&&0!==f?f:0}function P(a,b){if(!b_(a))throw TypeError(`${b} is not a ReadableStream.`)}function Q(a){return new V(a)}function R(a,b){a._reader._readRequests.push(b)}function S(a,b,c){let d=a._reader._readRequests.shift();c?d._closeSteps():d._chunkSteps(b)}function T(a){return a._reader._readRequests.length}function U(a){let b=a._reader;return void 0!==b&&!!W(b)}class V{constructor(a){if(L(a,1,"ReadableStreamDefaultReader"),P(a,"First parameter"),b0(a))throw TypeError("This stream has already been locked for exclusive reading by another reader");z(this,a),this._readRequests=new t}get closed(){return W(this)?this._closedPromise:j(Z("closed"))}cancel(a){return W(this)?void 0===this._ownerReadableStream?j(C("cancel")):A(this,a):j(Z("cancel"))}read(){let a,b;if(!W(this))return j(Z("read"));if(void 0===this._ownerReadableStream)return j(C("read from"));let c=k((c,d)=>{a=c,b=d});return X(this,{_chunkSteps:b=>a({value:b,done:!1}),_closeSteps:()=>a({value:void 0,done:!0}),_errorSteps:a=>b(a)}),c}releaseLock(){var a;if(!W(this))throw Z("releaseLock");void 0!==this._ownerReadableStream&&(a=this,B(a),Y(a,TypeError("Reader was released")))}}function W(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_readRequests")&&a instanceof V}function X(a,b){let c=a._ownerReadableStream;c._disturbed=!0,"closed"===c._state?b._closeSteps():"errored"===c._state?b._errorSteps(c._storedError):c._readableStreamController[x](b)}function Y(a,b){let c=a._readRequests;a._readRequests=new t,c.forEach(a=>{a._errorSteps(b)})}function Z(a){return TypeError(`ReadableStreamDefaultReader.prototype.${a} can only be used on a ReadableStreamDefaultReader`)}Object.defineProperties(V.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),g(V.prototype.cancel,"cancel"),g(V.prototype.read,"read"),g(V.prototype.releaseLock,"releaseLock"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(V.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});let $=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class _{constructor(a,b){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=a,this._preventCancel=b}next(){let a=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?m(this._ongoingPromise,a,a):a(),this._ongoingPromise}return(a){let b=()=>this._returnSteps(a);return this._ongoingPromise?m(this._ongoingPromise,b,b):b()}_nextSteps(){let a,b;if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let c=this._reader,d=k((c,d)=>{a=c,b=d});return X(c,{_chunkSteps:b=>{this._ongoingPromise=void 0,q(()=>a({value:b,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,B(c),a({value:void 0,done:!0})},_errorSteps:a=>{this._ongoingPromise=void 0,this._isFinished=!0,B(c),b(a)}}),d}_returnSteps(a){if(this._isFinished)return Promise.resolve({value:a,done:!0});this._isFinished=!0;let b=this._reader;if(!this._preventCancel){let c=A(b,a);return B(b),m(c,()=>({value:a,done:!0}),void 0)}return B(b),l({value:a,done:!0})}}let aa={next(){return ab(this)?this._asyncIteratorImpl.next():j(ac("next"))},return(a){return ab(this)?this._asyncIteratorImpl.return(a):j(ac("return"))}};function ab(a){if(!f(a)||!Object.prototype.hasOwnProperty.call(a,"_asyncIteratorImpl"))return!1;try{return a._asyncIteratorImpl instanceof _}catch(a){return!1}}function ac(a){return TypeError(`ReadableStreamAsyncIterator.${a} can only be used on a ReadableSteamAsyncIterator`)}Object.setPrototypeOf(aa,$);let ad=Number.isNaN||function(a){return a!=a};function ae(a){return a.slice()}function af(a,b,c,d,e){new Uint8Array(a).set(new Uint8Array(c,d,e),b)}let ag=a=>(ag="function"==typeof a.transfer?a=>a.transfer():"function"==typeof structuredClone?a=>structuredClone(a,{transfer:[a]}):a=>a)(a),ah=a=>(ah="boolean"==typeof a.detached?a=>a.detached:a=>0===a.byteLength)(a);function ai(a,b,c){if(a.slice)return a.slice(b,c);let d=c-b,e=new ArrayBuffer(d);return af(e,0,a,b,d),e}function aj(a,b){let c=a[b];if(null!=c){if("function"!=typeof c)throw TypeError(`${String(b)} is not a function`);return c}}let ak=null!=(d=null!=(b=Symbol.asyncIterator)?b:null==(c=Symbol.for)?void 0:c.call(Symbol,"Symbol.asyncIterator"))?d:"@@asyncIterator";function al(a){return new Uint8Array(ai(a.buffer,a.byteOffset,a.byteOffset+a.byteLength))}function am(a){let b=a._queue.shift();return a._queueTotalSize-=b.size,a._queueTotalSize<0&&(a._queueTotalSize=0),b.value}function an(a,b,c){if(!(!("number"!=typeof c||ad(c))&&!(c<0)&&1)||c===1/0)throw RangeError("Size must be a finite, non-NaN, non-negative number.");a._queue.push({value:b,size:c}),a._queueTotalSize+=c}function ao(a){a._queue=new t,a._queueTotalSize=0}function ap(a){return a===DataView}class aq{constructor(){throw TypeError("Illegal constructor")}get view(){if(!at(this))throw aS("view");return this._view}respond(a){if(!at(this))throw aS("respond");if(L(a,1,"respond"),a=O(a,"First parameter"),void 0===this._associatedReadableByteStreamController)throw TypeError("This BYOB request has been invalidated");if(ah(this._view.buffer))throw TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");aP(this._associatedReadableByteStreamController,a)}respondWithNewView(a){if(!at(this))throw aS("respondWithNewView");if(L(a,1,"respondWithNewView"),!ArrayBuffer.isView(a))throw TypeError("You can only respond with array buffer views");if(void 0===this._associatedReadableByteStreamController)throw TypeError("This BYOB request has been invalidated");if(ah(a.buffer))throw TypeError("The given view's buffer has been detached and so cannot be used as a response");aQ(this._associatedReadableByteStreamController,a)}}Object.defineProperties(aq.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),g(aq.prototype.respond,"respond"),g(aq.prototype.respondWithNewView,"respondWithNewView"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(aq.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class ar{constructor(){throw TypeError("Illegal constructor")}get byobRequest(){if(!as(this))throw aT("byobRequest");return aN(this)}get desiredSize(){if(!as(this))throw aT("desiredSize");return aO(this)}close(){if(!as(this))throw aT("close");if(this._closeRequested)throw TypeError("The stream has already been closed; do not close it again!");let a=this._controlledReadableByteStream._state;if("readable"!==a)throw TypeError(`The stream (in ${a} state) is not in the readable state and cannot be closed`);aJ(this)}enqueue(a){if(!as(this))throw aT("enqueue");if(L(a,1,"enqueue"),!ArrayBuffer.isView(a))throw TypeError("chunk must be an array buffer view");if(0===a.byteLength)throw TypeError("chunk must have non-zero byteLength");if(0===a.buffer.byteLength)throw TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw TypeError("stream is closed or draining");let b=this._controlledReadableByteStream._state;if("readable"!==b)throw TypeError(`The stream (in ${b} state) is not in the readable state and cannot be enqueued to`);aK(this,a)}error(a){if(!as(this))throw aT("error");aL(this,a)}[w](a){av(this),ao(this);let b=this._cancelAlgorithm(a);return aI(this),b}[x](a){let b=this._controlledReadableByteStream;if(this._queueTotalSize>0)return void aM(this,a);let c=this._autoAllocateChunkSize;if(void 0!==c){let b;try{b=new ArrayBuffer(c)}catch(b){a._errorSteps(b);return}let d={buffer:b,bufferByteLength:c,byteOffset:0,byteLength:c,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(d)}R(b,a),au(this)}[y](){if(this._pendingPullIntos.length>0){let a=this._pendingPullIntos.peek();a.readerType="none",this._pendingPullIntos=new t,this._pendingPullIntos.push(a)}}}function as(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_controlledReadableByteStream")&&a instanceof ar}function at(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_associatedReadableByteStreamController")&&a instanceof aq}function au(a){if(function(a){let b=a._controlledReadableByteStream;return"readable"===b._state&&!a._closeRequested&&!!a._started&&!!(U(b)&&T(b)>0||aW(b)&&aV(b)>0||aO(a)>0)}(a)){if(a._pulling){a._pullAgain=!0;return}a._pulling=!0,n(a._pullAlgorithm(),()=>(a._pulling=!1,a._pullAgain&&(a._pullAgain=!1,au(a)),null),b=>(aL(a,b),null))}}function av(a){aE(a),a._pendingPullIntos=new t}function aw(a,b){let c=!1;"closed"===a._state&&(c=!0);let d=ax(b);"default"===b.readerType?S(a,d,c):function(a,b,c){let d=a._reader._readIntoRequests.shift();c?d._closeSteps(b):d._chunkSteps(b)}(a,d,c)}function ax(a){let b=a.bytesFilled,c=a.elementSize;return new a.viewConstructor(a.buffer,a.byteOffset,b/c)}function ay(a,b,c,d){a._queue.push({buffer:b,byteOffset:c,byteLength:d}),a._queueTotalSize+=d}function az(a,b,c,d){let e;try{e=ai(b,c,c+d)}catch(b){throw aL(a,b),b}ay(a,e,0,d)}function aA(a,b){b.bytesFilled>0&&az(a,b.buffer,b.byteOffset,b.bytesFilled),aH(a)}function aB(a,b){let c=Math.min(a._queueTotalSize,b.byteLength-b.bytesFilled),d=b.bytesFilled+c,e=c,f=!1,g=d%b.elementSize,h=d-g;h>=b.minimumFill&&(e=h-b.bytesFilled,f=!0);let i=a._queue;for(;e>0;){let c=i.peek(),d=Math.min(e,c.byteLength),f=b.byteOffset+b.bytesFilled;af(b.buffer,f,c.buffer,c.byteOffset,d),c.byteLength===d?i.shift():(c.byteOffset+=d,c.byteLength-=d),a._queueTotalSize-=d,aC(a,d,b),e-=d}return f}function aC(a,b,c){c.bytesFilled+=b}function aD(a){0===a._queueTotalSize&&a._closeRequested?(aI(a),b2(a._controlledReadableByteStream)):au(a)}function aE(a){null!==a._byobRequest&&(a._byobRequest._associatedReadableByteStreamController=void 0,a._byobRequest._view=null,a._byobRequest=null)}function aF(a){for(;a._pendingPullIntos.length>0;){if(0===a._queueTotalSize)return;let b=a._pendingPullIntos.peek();aB(a,b)&&(aH(a),aw(a._controlledReadableByteStream,b))}}function aG(a,b){let c=a._pendingPullIntos.peek();if(aE(a),"closed"===a._controlledReadableByteStream._state){"none"===c.readerType&&aH(a);let b=a._controlledReadableByteStream;if(aW(b))for(;aV(b)>0;)aw(b,aH(a))}else!function(a,b,c){if(aC(a,b,c),"none"===c.readerType){aA(a,c),aF(a);return}if(c.bytesFilled<c.minimumFill)return;aH(a);let d=c.bytesFilled%c.elementSize;if(d>0){let b=c.byteOffset+c.bytesFilled;az(a,c.buffer,b-d,d)}c.bytesFilled-=d,aw(a._controlledReadableByteStream,c),aF(a)}(a,b,c);au(a)}function aH(a){return a._pendingPullIntos.shift()}function aI(a){a._pullAlgorithm=void 0,a._cancelAlgorithm=void 0}function aJ(a){let b=a._controlledReadableByteStream;if(!a._closeRequested&&"readable"===b._state){if(a._queueTotalSize>0){a._closeRequested=!0;return}if(a._pendingPullIntos.length>0){let b=a._pendingPullIntos.peek();if(b.bytesFilled%b.elementSize!=0){let b=TypeError("Insufficient bytes to fill elements in the given buffer");throw aL(a,b),b}}aI(a),b2(b)}}function aK(a,b){let c=a._controlledReadableByteStream;if(a._closeRequested||"readable"!==c._state)return;let{buffer:d,byteOffset:e,byteLength:f}=b;if(ah(d))throw TypeError("chunk's buffer is detached and so cannot be enqueued");let g=ag(d);if(a._pendingPullIntos.length>0){let b=a._pendingPullIntos.peek();if(ah(b.buffer))throw TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");aE(a),b.buffer=ag(b.buffer),"none"===b.readerType&&aA(a,b)}U(c)?(!function(a){let b=a._controlledReadableByteStream._reader;for(;b._readRequests.length>0;){if(0===a._queueTotalSize)return;aM(a,b._readRequests.shift())}}(a),0===T(c)?ay(a,g,e,f):(a._pendingPullIntos.length>0&&aH(a),S(c,new Uint8Array(g,e,f),!1))):aW(c)?(ay(a,g,e,f),aF(a)):ay(a,g,e,f),au(a)}function aL(a,b){let c=a._controlledReadableByteStream;"readable"===c._state&&(av(a),ao(a),aI(a),b3(c,b))}function aM(a,b){let c=a._queue.shift();a._queueTotalSize-=c.byteLength,aD(a);let d=new Uint8Array(c.buffer,c.byteOffset,c.byteLength);b._chunkSteps(d)}function aN(a){if(null===a._byobRequest&&a._pendingPullIntos.length>0){var b,c,d;let e=a._pendingPullIntos.peek(),f=new Uint8Array(e.buffer,e.byteOffset+e.bytesFilled,e.byteLength-e.bytesFilled),g=Object.create(aq.prototype);b=g,c=a,d=f,b._associatedReadableByteStreamController=c,b._view=d,a._byobRequest=g}return a._byobRequest}function aO(a){let b=a._controlledReadableByteStream._state;return"errored"===b?null:"closed"===b?0:a._strategyHWM-a._queueTotalSize}function aP(a,b){let c=a._pendingPullIntos.peek();if("closed"===a._controlledReadableByteStream._state){if(0!==b)throw TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(0===b)throw TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(c.bytesFilled+b>c.byteLength)throw RangeError("bytesWritten out of range")}c.buffer=ag(c.buffer),aG(a,b)}function aQ(a,b){let c=a._pendingPullIntos.peek();if("closed"===a._controlledReadableByteStream._state){if(0!==b.byteLength)throw TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(0===b.byteLength)throw TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(c.byteOffset+c.bytesFilled!==b.byteOffset)throw RangeError("The region specified by view does not match byobRequest");if(c.bufferByteLength!==b.buffer.byteLength)throw RangeError("The buffer of view has different capacity than byobRequest");if(c.bytesFilled+b.byteLength>c.byteLength)throw RangeError("The region specified by view is larger than byobRequest");let d=b.byteLength;c.buffer=ag(b.buffer),aG(a,d)}function aR(a,b,c,d,e,f,g){b._controlledReadableByteStream=a,b._pullAgain=!1,b._pulling=!1,b._byobRequest=null,b._queue=b._queueTotalSize=void 0,ao(b),b._closeRequested=!1,b._started=!1,b._strategyHWM=f,b._pullAlgorithm=d,b._cancelAlgorithm=e,b._autoAllocateChunkSize=g,b._pendingPullIntos=new t,a._readableStreamController=b,n(l(c()),()=>(b._started=!0,au(b),null),a=>(aL(b,a),null))}function aS(a){return TypeError(`ReadableStreamBYOBRequest.prototype.${a} can only be used on a ReadableStreamBYOBRequest`)}function aT(a){return TypeError(`ReadableByteStreamController.prototype.${a} can only be used on a ReadableByteStreamController`)}Object.defineProperties(ar.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),g(ar.prototype.close,"close"),g(ar.prototype.enqueue,"enqueue"),g(ar.prototype.error,"error"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(ar.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function aU(a,b){a._reader._readIntoRequests.push(b)}function aV(a){return a._reader._readIntoRequests.length}function aW(a){let b=a._reader;return void 0!==b&&!!aY(b)}class aX{constructor(a){if(L(a,1,"ReadableStreamBYOBReader"),P(a,"First parameter"),b0(a))throw TypeError("This stream has already been locked for exclusive reading by another reader");if(!as(a._readableStreamController))throw TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");z(this,a),this._readIntoRequests=new t}get closed(){return aY(this)?this._closedPromise:j(a_("closed"))}cancel(a){return aY(this)?void 0===this._ownerReadableStream?j(C("cancel")):A(this,a):j(a_("cancel"))}read(a,b={}){let c,d,e;if(!aY(this))return j(a_("read"));if(!ArrayBuffer.isView(a))return j(TypeError("view must be an array buffer view"));if(0===a.byteLength)return j(TypeError("view must have non-zero byteLength"));if(0===a.buffer.byteLength)return j(TypeError("view's buffer must have non-zero byteLength"));if(ah(a.buffer))return j(TypeError("view's buffer has been detached"));try{var f;I(b,"options"),c={min:O(null!=(f=null==b?void 0:b.min)?f:1,"options has member 'min' that")}}catch(a){return j(a)}let g=c.min;if(0===g)return j(TypeError("options.min must be greater than 0"));if(ap(a.constructor)){if(g>a.byteLength)return j(RangeError("options.min must be less than or equal to view's byteLength"))}else if(g>a.length)return j(RangeError("options.min must be less than or equal to view's length"));if(void 0===this._ownerReadableStream)return j(C("read from"));let h=k((a,b)=>{d=a,e=b});return aZ(this,a,g,{_chunkSteps:a=>d({value:a,done:!1}),_closeSteps:a=>d({value:a,done:!0}),_errorSteps:a=>e(a)}),h}releaseLock(){var a;if(!aY(this))throw a_("releaseLock");void 0!==this._ownerReadableStream&&(a=this,B(a),a$(a,TypeError("Reader was released")))}}function aY(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_readIntoRequests")&&a instanceof aX}function aZ(a,b,c,d){let e=a._ownerReadableStream;e._disturbed=!0,"errored"===e._state?d._errorSteps(e._storedError):function(a,b,c,d){let e,f=a._controlledReadableByteStream,g=b.constructor,h=ap(g)?1:g.BYTES_PER_ELEMENT,{byteOffset:i,byteLength:j}=b;try{e=ag(b.buffer)}catch(a){d._errorSteps(a);return}let k={buffer:e,bufferByteLength:e.byteLength,byteOffset:i,byteLength:j,bytesFilled:0,minimumFill:c*h,elementSize:h,viewConstructor:g,readerType:"byob"};if(a._pendingPullIntos.length>0){a._pendingPullIntos.push(k),aU(f,d);return}if("closed"===f._state){let a=new g(k.buffer,k.byteOffset,0);d._closeSteps(a);return}if(a._queueTotalSize>0){if(aB(a,k)){let b=ax(k);aD(a),d._chunkSteps(b);return}if(a._closeRequested){let b=TypeError("Insufficient bytes to fill elements in the given buffer");aL(a,b),d._errorSteps(b);return}}a._pendingPullIntos.push(k),aU(f,d),au(a)}(e._readableStreamController,b,c,d)}function a$(a,b){let c=a._readIntoRequests;a._readIntoRequests=new t,c.forEach(a=>{a._errorSteps(b)})}function a_(a){return TypeError(`ReadableStreamBYOBReader.prototype.${a} can only be used on a ReadableStreamBYOBReader`)}function a0(a,b){let{highWaterMark:c}=a;if(void 0===c)return b;if(ad(c)||c<0)throw RangeError("Invalid highWaterMark");return c}function a1(a){let{size:b}=a;return b||(()=>1)}function a2(a,b){var c;I(a,b);let d=null==a?void 0:a.highWaterMark,e=null==a?void 0:a.size;return{highWaterMark:void 0===d?void 0:N(d),size:void 0===e?void 0:(J(c=e,`${b} has member 'size' that`),a=>N(c(a)))}}function a3(a,b){if(!a7(a))throw TypeError(`${b} is not a WritableStream.`)}Object.defineProperties(aX.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),g(aX.prototype.cancel,"cancel"),g(aX.prototype.read,"read"),g(aX.prototype.releaseLock,"releaseLock"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(aX.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});let a4="function"==typeof AbortController;class a5{constructor(a={},b={}){void 0===a?a=null:K(a,"First parameter");let c=a2(b,"Second parameter"),d=function(a,b){var c,d,e,f,g,h,i,j;I(a,b);let k=null==a?void 0:a.abort,l=null==a?void 0:a.close,m=null==a?void 0:a.start,n=null==a?void 0:a.type,o=null==a?void 0:a.write;return{abort:void 0===k?void 0:(c=k,d=a,J(c,`${b} has member 'abort' that`),a=>s(c,d,[a])),close:void 0===l?void 0:(e=l,f=a,J(e,`${b} has member 'close' that`),()=>s(e,f,[])),start:void 0===m?void 0:(g=m,h=a,J(g,`${b} has member 'start' that`),a=>r(g,h,[a])),write:void 0===o?void 0:(i=o,j=a,J(i,`${b} has member 'write' that`),(a,b)=>s(i,j,[a,b])),type:n}}(a,"First parameter");if(a6(this),void 0!==d.type)throw RangeError("Invalid type is specified");let e=a1(c);!function(a,b,c,d){let e,f,g=Object.create(bo.prototype);e=void 0!==b.start?()=>b.start(g):()=>void 0,f=void 0!==b.write?a=>b.write(a,g):()=>l(void 0),bq(a,g,e,f,void 0!==b.close?()=>b.close():()=>l(void 0),void 0!==b.abort?a=>b.abort(a):()=>l(void 0),c,d)}(this,d,a0(c,1),e)}get locked(){if(!a7(this))throw bw("locked");return a8(this)}abort(a){return a7(this)?a8(this)?j(TypeError("Cannot abort a stream that already has a writer")):a9(this,a):j(bw("abort"))}close(){return a7(this)?a8(this)?j(TypeError("Cannot close a stream that already has a writer")):be(this)?j(TypeError("Cannot close an already-closing stream")):ba(this):j(bw("close"))}getWriter(){var a;if(!a7(this))throw bw("getWriter");return a=this,new bh(a)}}function a6(a){a._state="writable",a._storedError=void 0,a._writer=void 0,a._writableStreamController=void 0,a._writeRequests=new t,a._inFlightWriteRequest=void 0,a._closeRequest=void 0,a._inFlightCloseRequest=void 0,a._pendingAbortRequest=void 0,a._backpressure=!1}function a7(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_writableStreamController")&&a instanceof a5}function a8(a){return void 0!==a._writer}function a9(a,b){var c;if("closed"===a._state||"errored"===a._state)return l(void 0);a._writableStreamController._abortReason=b,null==(c=a._writableStreamController._abortController)||c.abort(b);let d=a._state;if("closed"===d||"errored"===d)return l(void 0);if(void 0!==a._pendingAbortRequest)return a._pendingAbortRequest._promise;let e=!1;"erroring"===d&&(e=!0,b=void 0);let f=k((c,d)=>{a._pendingAbortRequest={_promise:void 0,_resolve:c,_reject:d,_reason:b,_wasAlreadyErroring:e}});return a._pendingAbortRequest._promise=f,e||bc(a,b),f}function ba(a){var b;let c=a._state;if("closed"===c||"errored"===c)return j(TypeError(`The stream (in ${c} state) is not in the writable state and cannot be closed`));let d=k((b,c)=>{a._closeRequest={_resolve:b,_reject:c}}),e=a._writer;return void 0!==e&&a._backpressure&&"writable"===c&&bG(e),an(b=a._writableStreamController,bn,0),bt(b),d}function bb(a,b){if("writable"===a._state)return void bc(a,b);bd(a)}function bc(a,b){var c;let d=a._writableStreamController;a._state="erroring",a._storedError=b;let e=a._writer;void 0!==e&&bk(e,b),void 0===(c=a)._inFlightWriteRequest&&void 0===c._inFlightCloseRequest&&d._started&&bd(a)}function bd(a){a._state="errored",a._writableStreamController[v]();let b=a._storedError;if(a._writeRequests.forEach(a=>{a._reject(b)}),a._writeRequests=new t,void 0===a._pendingAbortRequest)return void bf(a);let c=a._pendingAbortRequest;if(a._pendingAbortRequest=void 0,c._wasAlreadyErroring){c._reject(b),bf(a);return}n(a._writableStreamController[u](c._reason),()=>(c._resolve(),bf(a),null),b=>(c._reject(b),bf(a),null))}function be(a){return void 0!==a._closeRequest||void 0!==a._inFlightCloseRequest}function bf(a){void 0!==a._closeRequest&&(a._closeRequest._reject(a._storedError),a._closeRequest=void 0);let b=a._writer;void 0!==b&&bB(b,a._storedError)}function bg(a,b){let c=a._writer;void 0!==c&&b!==a._backpressure&&(b?bD(c):bG(c)),a._backpressure=b}Object.defineProperties(a5.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),g(a5.prototype.abort,"abort"),g(a5.prototype.close,"close"),g(a5.prototype.getWriter,"getWriter"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(a5.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});class bh{constructor(a){if(L(a,1,"WritableStreamDefaultWriter"),a3(a,"First parameter"),a8(a))throw TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=a,a._writer=this;let b=a._state;if("writable"===b)!be(a)&&a._backpressure?bD(this):function(a){bD(a),bG(a)}(this),bA(this);else if("erroring"===b)bE(this,a._storedError),bA(this);else if("closed"===b)(function(a){bD(a),bG(a)})(this),function(a){bA(a),bC(a)}(this);else{let b=a._storedError;bE(this,b),function(a,b){bA(a),bB(a,b)}(this,b)}}get closed(){return bi(this)?this._closedPromise:j(by("closed"))}get desiredSize(){if(!bi(this))throw by("desiredSize");if(void 0===this._ownerWritableStream)throw bz("desiredSize");var a=this;let b=a._ownerWritableStream,c=b._state;return"errored"===c||"erroring"===c?null:"closed"===c?0:bs(b._writableStreamController)}get ready(){return bi(this)?this._readyPromise:j(by("ready"))}abort(a){var b,c;if(!bi(this))return j(by("abort"));if(void 0===this._ownerWritableStream)return j(bz("abort"));return b=this,c=a,a9(b._ownerWritableStream,c)}close(){if(!bi(this))return j(by("close"));let a=this._ownerWritableStream;return void 0===a?j(bz("close")):be(a)?j(TypeError("Cannot close an already-closing stream")):bj(this)}releaseLock(){if(!bi(this))throw by("releaseLock");void 0!==this._ownerWritableStream&&bl(this)}write(a){return bi(this)?void 0===this._ownerWritableStream?j(bz("write to")):bm(this,a):j(by("write"))}}function bi(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_ownerWritableStream")&&a instanceof bh}function bj(a){return ba(a._ownerWritableStream)}function bk(a,b){"pending"===a._readyPromiseState?bF(a,b):bE(a,b)}function bl(a){let b=a._ownerWritableStream,c=TypeError("Writer was released and can no longer be used to monitor the stream's closedness");bk(a,c),"pending"===a._closedPromiseState?bB(a,c):function(a,b){bA(a),bB(a,b)}(a,c),b._writer=void 0,a._ownerWritableStream=void 0}function bm(a,b){let c=a._ownerWritableStream,d=c._writableStreamController,e=function(a,b){try{return a._strategySizeAlgorithm(b)}catch(b){return bu(a,b),1}}(d,b);if(c!==a._ownerWritableStream)return j(bz("write to"));let f=c._state;if("errored"===f)return j(c._storedError);if(be(c)||"closed"===f)return j(TypeError("The stream is closing or closed and cannot be written to"));if("erroring"===f)return j(c._storedError);let g=k((a,b)=>{c._writeRequests.push({_resolve:a,_reject:b})});return function(a,b,c){try{an(a,b,c)}catch(b){bu(a,b);return}let d=a._controlledWritableStream;be(d)||"writable"!==d._state||bg(d,function(a){return 0>=bs(a)}(a)),bt(a)}(d,b,e),g}Object.defineProperties(bh.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),g(bh.prototype.abort,"abort"),g(bh.prototype.close,"close"),g(bh.prototype.releaseLock,"releaseLock"),g(bh.prototype.write,"write"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(bh.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});let bn={};class bo{constructor(){throw TypeError("Illegal constructor")}get abortReason(){if(!bp(this))throw bx("abortReason");return this._abortReason}get signal(){if(!bp(this))throw bx("signal");if(void 0===this._abortController)throw TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(a){if(!bp(this))throw bx("error");"writable"===this._controlledWritableStream._state&&bv(this,a)}[u](a){let b=this._abortAlgorithm(a);return br(this),b}[v](){ao(this)}}function bp(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_controlledWritableStream")&&a instanceof bo}function bq(a,b,c,d,e,f,g,h){b._controlledWritableStream=a,a._writableStreamController=b,b._queue=void 0,b._queueTotalSize=void 0,ao(b),b._abortReason=void 0,b._abortController=function(){if(a4)return new AbortController}(),b._started=!1,b._strategySizeAlgorithm=h,b._strategyHWM=g,b._writeAlgorithm=d,b._closeAlgorithm=e,b._abortAlgorithm=f,bg(a,0>=bs(b)),n(l(c()),()=>(b._started=!0,bt(b),null),c=>(b._started=!0,bb(a,c),null))}function br(a){a._writeAlgorithm=void 0,a._closeAlgorithm=void 0,a._abortAlgorithm=void 0,a._strategySizeAlgorithm=void 0}function bs(a){return a._strategyHWM-a._queueTotalSize}function bt(a){let b=a._controlledWritableStream;if(!a._started||void 0!==b._inFlightWriteRequest)return;if("erroring"===b._state)return void bd(b);if(0===a._queue.length)return;let c=a._queue.peek().value;c===bn?function(a){let b=a._controlledWritableStream;b._inFlightCloseRequest=b._closeRequest,b._closeRequest=void 0,am(a);let c=a._closeAlgorithm();br(a),n(c,()=>{b._inFlightCloseRequest._resolve(void 0),b._inFlightCloseRequest=void 0,"erroring"===b._state&&(b._storedError=void 0,void 0!==b._pendingAbortRequest&&(b._pendingAbortRequest._resolve(),b._pendingAbortRequest=void 0)),b._state="closed";let a=b._writer;return void 0!==a&&bC(a),null},a=>(b._inFlightCloseRequest._reject(a),b._inFlightCloseRequest=void 0,void 0!==b._pendingAbortRequest&&(b._pendingAbortRequest._reject(a),b._pendingAbortRequest=void 0),bb(b,a),null))}(a):function(a,b){let c=a._controlledWritableStream;c._inFlightWriteRequest=c._writeRequests.shift(),n(a._writeAlgorithm(b),()=>{c._inFlightWriteRequest._resolve(void 0),c._inFlightWriteRequest=void 0;let b=c._state;return am(a),be(c)||"writable"!==b||bg(c,function(a){return 0>=bs(a)}(a)),bt(a),null},b=>("writable"===c._state&&br(a),c._inFlightWriteRequest._reject(b),c._inFlightWriteRequest=void 0,bb(c,b),null))}(a,c)}function bu(a,b){"writable"===a._controlledWritableStream._state&&bv(a,b)}function bv(a,b){let c=a._controlledWritableStream;br(a),bc(c,b)}function bw(a){return TypeError(`WritableStream.prototype.${a} can only be used on a WritableStream`)}function bx(a){return TypeError(`WritableStreamDefaultController.prototype.${a} can only be used on a WritableStreamDefaultController`)}function by(a){return TypeError(`WritableStreamDefaultWriter.prototype.${a} can only be used on a WritableStreamDefaultWriter`)}function bz(a){return TypeError("Cannot "+a+" a stream using a released writer")}function bA(a){a._closedPromise=k((b,c)=>{a._closedPromise_resolve=b,a._closedPromise_reject=c,a._closedPromiseState="pending"})}Object.defineProperties(bo.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(bo.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function bB(a,b){void 0!==a._closedPromise_reject&&(p(a._closedPromise),a._closedPromise_reject(b),a._closedPromise_resolve=void 0,a._closedPromise_reject=void 0,a._closedPromiseState="rejected")}function bC(a){void 0!==a._closedPromise_resolve&&(a._closedPromise_resolve(void 0),a._closedPromise_resolve=void 0,a._closedPromise_reject=void 0,a._closedPromiseState="resolved")}function bD(a){a._readyPromise=k((b,c)=>{a._readyPromise_resolve=b,a._readyPromise_reject=c}),a._readyPromiseState="pending"}function bE(a,b){bD(a),bF(a,b)}function bF(a,b){void 0!==a._readyPromise_reject&&(p(a._readyPromise),a._readyPromise_reject(b),a._readyPromise_resolve=void 0,a._readyPromise_reject=void 0,a._readyPromiseState="rejected")}function bG(a){void 0!==a._readyPromise_resolve&&(a._readyPromise_resolve(void 0),a._readyPromise_resolve=void 0,a._readyPromise_reject=void 0,a._readyPromiseState="fulfilled")}let bH="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof global?global:void 0,bI=function(){let a=null==bH?void 0:bH.DOMException;return!function(a){if("function"!=typeof a&&"object"!=typeof a||"DOMException"!==a.name)return!1;try{return new a,!0}catch(a){return!1}}(a)?void 0:a}()||function(){let a=function(a,b){this.message=a||"",this.name=b||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return g(a,"DOMException"),a.prototype=Object.create(Error.prototype),Object.defineProperty(a.prototype,"constructor",{value:a,writable:!0,configurable:!0}),a}();function bJ(a,b,c,d,f,g){let h=Q(a),i=new bh(b);a._disturbed=!0;let q=!1,r=l(void 0);return k((s,t)=>{var u,v,w;let x;if(void 0!==g){if(x=()=>{let c=void 0!==g.reason?g.reason:new bI("Aborted","AbortError"),e=[];d||e.push(()=>"writable"===b._state?a9(b,c):l(void 0)),f||e.push(()=>"readable"===a._state?b1(a,c):l(void 0)),A(()=>Promise.all(e.map(a=>a())),!0,c)},g.aborted)return void x();g.addEventListener("abort",x)}if(z(a,h._closedPromise,a=>(d?C(!0,a):A(()=>a9(b,a),!0,a),null)),z(b,i._closedPromise,b=>(f?C(!0,b):A(()=>b1(a,b),!0,b),null)),u=a,v=h._closedPromise,w=()=>(c?C():A(()=>(function(a){let b=a._ownerWritableStream,c=b._state;return be(b)||"closed"===c?l(void 0):"errored"===c?j(b._storedError):bj(a)})(i)),null),"closed"===u._state?w():n(v,w),be(b)||"closed"===b._state){let b=TypeError("the destination writable stream closed before all data could be piped to it");f?C(!0,b):A(()=>b1(a,b),!0,b)}function y(){let a=r;return m(r,()=>a!==r?y():void 0)}function z(a,b,c){"errored"===a._state?c(a._storedError):o(b,c)}function A(a,c,d){if(!q)if(q=!0,"writable"!==b._state||be(b))e();else n(y(),e);function e(){return n(a(),()=>D(c,d),a=>D(!0,a)),null}}function C(a,c){if(!q)if(q=!0,"writable"!==b._state||be(b))D(a,c);else n(y(),()=>D(a,c))}function D(a,b){return bl(i),B(h),void 0!==g&&g.removeEventListener("abort",x),a?t(b):s(void 0),null}p(k((a,b)=>{!function c(d){d?a():m(q?l(!0):m(i._readyPromise,()=>k((a,b)=>{X(h,{_chunkSteps:b=>{r=m(bm(i,b),void 0,e),a(!1)},_closeSteps:()=>a(!0),_errorSteps:b})})),c,b)}(!1)}))})}class bK{constructor(){throw TypeError("Illegal constructor")}get desiredSize(){if(!bL(this))throw bV("desiredSize");return bS(this)}close(){if(!bL(this))throw bV("close");if(!bT(this))throw TypeError("The stream is not in a state that permits close");bP(this)}enqueue(a){if(!bL(this))throw bV("enqueue");if(!bT(this))throw TypeError("The stream is not in a state that permits enqueue");return bQ(this,a)}error(a){if(!bL(this))throw bV("error");bR(this,a)}[w](a){ao(this);let b=this._cancelAlgorithm(a);return bO(this),b}[x](a){let b=this._controlledReadableStream;if(this._queue.length>0){let c=am(this);this._closeRequested&&0===this._queue.length?(bO(this),b2(b)):bM(this),a._chunkSteps(c)}else R(b,a),bM(this)}[y](){}}function bL(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_controlledReadableStream")&&a instanceof bK}function bM(a){if(bN(a)){if(a._pulling){a._pullAgain=!0;return}a._pulling=!0,n(a._pullAlgorithm(),()=>(a._pulling=!1,a._pullAgain&&(a._pullAgain=!1,bM(a)),null),b=>(bR(a,b),null))}}function bN(a){let b=a._controlledReadableStream;return!!bT(a)&&!!a._started&&!!(b0(b)&&T(b)>0||bS(a)>0)}function bO(a){a._pullAlgorithm=void 0,a._cancelAlgorithm=void 0,a._strategySizeAlgorithm=void 0}function bP(a){if(!bT(a))return;let b=a._controlledReadableStream;a._closeRequested=!0,0===a._queue.length&&(bO(a),b2(b))}function bQ(a,b){if(!bT(a))return;let c=a._controlledReadableStream;if(b0(c)&&T(c)>0)S(c,b,!1);else{let c;try{c=a._strategySizeAlgorithm(b)}catch(b){throw bR(a,b),b}try{an(a,b,c)}catch(b){throw bR(a,b),b}}bM(a)}function bR(a,b){let c=a._controlledReadableStream;"readable"===c._state&&(ao(a),bO(a),b3(c,b))}function bS(a){let b=a._controlledReadableStream._state;return"errored"===b?null:"closed"===b?0:a._strategyHWM-a._queueTotalSize}function bT(a){let b=a._controlledReadableStream._state;return!a._closeRequested&&"readable"===b}function bU(a,b,c,d,e,f,g){b._controlledReadableStream=a,b._queue=void 0,b._queueTotalSize=void 0,ao(b),b._started=!1,b._closeRequested=!1,b._pullAgain=!1,b._pulling=!1,b._strategySizeAlgorithm=g,b._strategyHWM=f,b._pullAlgorithm=d,b._cancelAlgorithm=e,a._readableStreamController=b,n(l(c()),()=>(b._started=!0,bM(b),null),a=>(bR(b,a),null))}function bV(a){return TypeError(`ReadableStreamDefaultController.prototype.${a} can only be used on a ReadableStreamDefaultController`)}function bW(a,b){I(a,b);let c=null==a?void 0:a.preventAbort,d=null==a?void 0:a.preventCancel,e=null==a?void 0:a.preventClose,f=null==a?void 0:a.signal;return void 0!==f&&function(a,b){if(!function(a){if("object"!=typeof a||null===a)return!1;try{return"boolean"==typeof a.aborted}catch(a){return!1}}(a))throw TypeError(`${b} is not an AbortSignal.`)}(f,`${b} has member 'signal' that`),{preventAbort:!!c,preventCancel:!!d,preventClose:!!e,signal:f}}Object.defineProperties(bK.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),g(bK.prototype.close,"close"),g(bK.prototype.enqueue,"enqueue"),g(bK.prototype.error,"error"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(bK.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});class bX{constructor(a={},b={}){void 0===a?a=null:K(a,"First parameter");let c=a2(b,"Second parameter"),d=function(a,b){var c,d,e,f,g,h;I(a,b);let i=null==a?void 0:a.autoAllocateChunkSize,j=null==a?void 0:a.cancel,k=null==a?void 0:a.pull,l=null==a?void 0:a.start,m=null==a?void 0:a.type;return{autoAllocateChunkSize:void 0===i?void 0:O(i,`${b} has member 'autoAllocateChunkSize' that`),cancel:void 0===j?void 0:(c=j,d=a,J(c,`${b} has member 'cancel' that`),a=>s(c,d,[a])),pull:void 0===k?void 0:(e=k,f=a,J(e,`${b} has member 'pull' that`),a=>s(e,f,[a])),start:void 0===l?void 0:(g=l,h=a,J(g,`${b} has member 'start' that`),a=>r(g,h,[a])),type:void 0===m?void 0:function(a,b){if("bytes"!=(a=`${a}`))throw TypeError(`${b} '${a}' is not a valid enumeration value for ReadableStreamType`);return a}(m,`${b} has member 'type' that`)}}(a,"First parameter");if(b$(this),"bytes"===d.type){if(void 0!==c.size)throw RangeError("The strategy for a byte stream cannot have a size function");!function(a,b,c){let d,e,f,g=Object.create(ar.prototype);d=void 0!==b.start?()=>b.start(g):()=>void 0,e=void 0!==b.pull?()=>b.pull(g):()=>l(void 0),f=void 0!==b.cancel?a=>b.cancel(a):()=>l(void 0);let h=b.autoAllocateChunkSize;if(0===h)throw TypeError("autoAllocateChunkSize must be greater than 0");aR(a,g,d,e,f,c,h)}(this,d,a0(c,0))}else{let a=a1(c);!function(a,b,c,d){let e,f,g=Object.create(bK.prototype);e=void 0!==b.start?()=>b.start(g):()=>void 0,f=void 0!==b.pull?()=>b.pull(g):()=>l(void 0),bU(a,g,e,f,void 0!==b.cancel?a=>b.cancel(a):()=>l(void 0),c,d)}(this,d,a0(c,1),a)}}get locked(){if(!b_(this))throw b4("locked");return b0(this)}cancel(a){return b_(this)?b0(this)?j(TypeError("Cannot cancel a stream that already has a reader")):b1(this,a):j(b4("cancel"))}getReader(a){if(!b_(this))throw b4("getReader");return void 0===function(a,b){I(a,b);let c=null==a?void 0:a.mode;return{mode:void 0===c?void 0:function(a,b){if("byob"!=(a=`${a}`))throw TypeError(`${b} '${a}' is not a valid enumeration value for ReadableStreamReaderMode`);return a}(c,`${b} has member 'mode' that`)}}(a,"First parameter").mode?Q(this):new aX(this)}pipeThrough(a,b={}){if(!b_(this))throw b4("pipeThrough");L(a,1,"pipeThrough");let c=function(a,b){I(a,b);let c=null==a?void 0:a.readable;M(c,"readable","ReadableWritablePair"),P(c,`${b} has member 'readable' that`);let d=null==a?void 0:a.writable;return M(d,"writable","ReadableWritablePair"),a3(d,`${b} has member 'writable' that`),{readable:c,writable:d}}(a,"First parameter"),d=bW(b,"Second parameter");if(b0(this))throw TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(a8(c.writable))throw TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");return p(bJ(this,c.writable,d.preventClose,d.preventAbort,d.preventCancel,d.signal)),c.readable}pipeTo(a,b={}){let c;if(!b_(this))return j(b4("pipeTo"));if(void 0===a)return j("Parameter 1 is required in 'pipeTo'.");if(!a7(a))return j(TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));try{c=bW(b,"Second parameter")}catch(a){return j(a)}return b0(this)?j(TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):a8(a)?j(TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):bJ(this,a,c.preventClose,c.preventAbort,c.preventCancel,c.signal)}tee(){if(!b_(this))throw b4("tee");let a=as(this._readableStreamController)?function(a){let b,c,d,e,f,g=Q(a),h=!1,i=!1,j=!1,m=!1,n=!1,p=k(a=>{f=a});function r(a){o(a._closedPromise,b=>(a!==g||(aL(d._readableStreamController,b),aL(e._readableStreamController,b),m&&n||f(void 0)),null))}function s(){aY(g)&&(B(g),r(g=Q(a))),X(g,{_chunkSteps:b=>{q(()=>{i=!1,j=!1;let c=b;if(!m&&!n)try{c=al(b)}catch(b){aL(d._readableStreamController,b),aL(e._readableStreamController,b),f(b1(a,b));return}m||aK(d._readableStreamController,b),n||aK(e._readableStreamController,c),h=!1,i?u():j&&v()})},_closeSteps:()=>{h=!1,m||aJ(d._readableStreamController),n||aJ(e._readableStreamController),d._readableStreamController._pendingPullIntos.length>0&&aP(d._readableStreamController,0),e._readableStreamController._pendingPullIntos.length>0&&aP(e._readableStreamController,0),m&&n||f(void 0)},_errorSteps:()=>{h=!1}})}function t(b,c){W(g)&&(B(g),r(g=new aX(a)));let k=c?e:d,l=c?d:e;aZ(g,b,1,{_chunkSteps:b=>{q(()=>{i=!1,j=!1;let d=c?n:m;if(c?m:n)d||aQ(k._readableStreamController,b);else{let c;try{c=al(b)}catch(b){aL(k._readableStreamController,b),aL(l._readableStreamController,b),f(b1(a,b));return}d||aQ(k._readableStreamController,b),aK(l._readableStreamController,c)}h=!1,i?u():j&&v()})},_closeSteps:a=>{h=!1;let b=c?n:m,d=c?m:n;b||aJ(k._readableStreamController),d||aJ(l._readableStreamController),void 0!==a&&(b||aQ(k._readableStreamController,a),!d&&l._readableStreamController._pendingPullIntos.length>0&&aP(l._readableStreamController,0)),b&&d||f(void 0)},_errorSteps:()=>{h=!1}})}function u(){if(h)return i=!0,l(void 0);h=!0;let a=aN(d._readableStreamController);return null===a?s():t(a._view,!1),l(void 0)}function v(){if(h)return j=!0,l(void 0);h=!0;let a=aN(e._readableStreamController);return null===a?s():t(a._view,!0),l(void 0)}function w(){}return d=bZ(w,u,function(d){if(m=!0,b=d,n){let d=b1(a,ae([b,c]));f(d)}return p}),e=bZ(w,v,function(d){if(n=!0,c=d,m){let d=b1(a,ae([b,c]));f(d)}return p}),r(g),[d,e]}(this):function(a,b){let c,d,e,f,g,h=Q(a),i=!1,j=!1,m=!1,n=!1,p=k(a=>{g=a});function r(){return i?j=!0:(i=!0,X(h,{_chunkSteps:a=>{q(()=>{j=!1,m||bQ(e._readableStreamController,a),n||bQ(f._readableStreamController,a),i=!1,j&&r()})},_closeSteps:()=>{i=!1,m||bP(e._readableStreamController),n||bP(f._readableStreamController),m&&n||g(void 0)},_errorSteps:()=>{i=!1}})),l(void 0)}function s(){}return e=bY(s,r,function(b){if(m=!0,c=b,n){let b=b1(a,ae([c,d]));g(b)}return p}),f=bY(s,r,function(b){if(n=!0,d=b,m){let b=b1(a,ae([c,d]));g(b)}return p}),o(h._closedPromise,a=>(bR(e._readableStreamController,a),bR(f._readableStreamController,a),m&&n||g(void 0),null)),[e,f]}(this);return ae(a)}values(a){if(!b_(this))throw b4("values");return function(a,b){let c=new _(Q(a),b),d=Object.create(aa);return d._asyncIteratorImpl=c,d}(this,(I(a,"First parameter"),{preventCancel:!!(null==a?void 0:a.preventCancel)}).preventCancel)}[ak](a){return this.values(a)}static from(a){var b;let c;return f(a)&&void 0!==a.getReader?(b=a.getReader(),c=bY(e,function(){let a;try{a=b.read()}catch(a){return j(a)}return m(a,a=>{if(!f(a))throw TypeError("The promise returned by the reader.read() method must fulfill with an object");if(a.done)bP(c._readableStreamController);else{let b=a.value;bQ(c._readableStreamController,b)}},void 0)},function(a){try{return l(b.cancel(a))}catch(a){return j(a)}},0)):function(a){let b,c=function a(b,c="sync",d){if(void 0===d)if("async"===c){if(void 0===(d=aj(b,ak))){let c=aj(b,Symbol.iterator);var e=a(b,"sync",c);let d={[Symbol.iterator]:()=>e.iterator},f=async function*(){return yield*d}(),g=f.next;return{iterator:f,nextMethod:g,done:!1}}}else d=aj(b,Symbol.iterator);if(void 0===d)throw TypeError("The object is not iterable");let g=r(d,b,[]);if(!f(g))throw TypeError("The iterator method must return an object");let h=g.next;return{iterator:g,nextMethod:h,done:!1}}(a,"async");return b=bY(e,function(){let a;try{a=function(a){let b=r(a.nextMethod,a.iterator,[]);if(!f(b))throw TypeError("The iterator.next() method must return an object");return b}(c)}catch(a){return j(a)}return m(l(a),a=>{if(!f(a))throw TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(a.done)bP(b._readableStreamController);else{let c=a.value;bQ(b._readableStreamController,c)}},void 0)},function(a){let b,d,e=c.iterator;try{b=aj(e,"return")}catch(a){return j(a)}if(void 0===b)return l(void 0);try{d=r(b,e,[a])}catch(a){return j(a)}return m(l(d),a=>{if(!f(a))throw TypeError("The promise returned by the iterator.return() method must fulfill with an object")},void 0)},0)}(a)}}function bY(a,b,c,d=1,e=()=>1){let f=Object.create(bX.prototype);return b$(f),bU(f,Object.create(bK.prototype),a,b,c,d,e),f}function bZ(a,b,c){let d=Object.create(bX.prototype);return b$(d),aR(d,Object.create(ar.prototype),a,b,c,0,void 0),d}function b$(a){a._state="readable",a._reader=void 0,a._storedError=void 0,a._disturbed=!1}function b_(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_readableStreamController")&&a instanceof bX}function b0(a){return void 0!==a._reader}function b1(a,b){if(a._disturbed=!0,"closed"===a._state)return l(void 0);if("errored"===a._state)return j(a._storedError);b2(a);let c=a._reader;if(void 0!==c&&aY(c)){let a=c._readIntoRequests;c._readIntoRequests=new t,a.forEach(a=>{a._closeSteps(void 0)})}return m(a._readableStreamController[w](b),e,void 0)}function b2(a){a._state="closed";let b=a._reader;if(void 0!==b&&(F(b),W(b))){let a=b._readRequests;b._readRequests=new t,a.forEach(a=>{a._closeSteps()})}}function b3(a,b){a._state="errored",a._storedError=b;let c=a._reader;void 0!==c&&(E(c,b),W(c)?Y(c,b):a$(c,b))}function b4(a){return TypeError(`ReadableStream.prototype.${a} can only be used on a ReadableStream`)}function b5(a,b){I(a,b);let c=null==a?void 0:a.highWaterMark;return M(c,"highWaterMark","QueuingStrategyInit"),{highWaterMark:N(c)}}Object.defineProperties(bX,{from:{enumerable:!0}}),Object.defineProperties(bX.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),g(bX.from,"from"),g(bX.prototype.cancel,"cancel"),g(bX.prototype.getReader,"getReader"),g(bX.prototype.pipeThrough,"pipeThrough"),g(bX.prototype.pipeTo,"pipeTo"),g(bX.prototype.tee,"tee"),g(bX.prototype.values,"values"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(bX.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(bX.prototype,ak,{value:bX.prototype.values,writable:!0,configurable:!0});let b6=a=>a.byteLength;g(b6,"size");class b7{constructor(a){L(a,1,"ByteLengthQueuingStrategy"),a=b5(a,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=a.highWaterMark}get highWaterMark(){if(!b9(this))throw b8("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!b9(this))throw b8("size");return b6}}function b8(a){return TypeError(`ByteLengthQueuingStrategy.prototype.${a} can only be used on a ByteLengthQueuingStrategy`)}function b9(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_byteLengthQueuingStrategyHighWaterMark")&&a instanceof b7}Object.defineProperties(b7.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(b7.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});let ca=()=>1;g(ca,"size");class cb{constructor(a){L(a,1,"CountQueuingStrategy"),a=b5(a,"First parameter"),this._countQueuingStrategyHighWaterMark=a.highWaterMark}get highWaterMark(){if(!cd(this))throw cc("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!cd(this))throw cc("size");return ca}}function cc(a){return TypeError(`CountQueuingStrategy.prototype.${a} can only be used on a CountQueuingStrategy`)}function cd(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_countQueuingStrategyHighWaterMark")&&a instanceof cb}Object.defineProperties(cb.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(cb.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});class ce{constructor(a={},b={},c={}){let d;void 0===a&&(a=null);let e=a2(b,"Second parameter"),f=a2(c,"Third parameter"),g=function(a,b){var c,d,e,f,g,h,i,j;I(a,b);let k=null==a?void 0:a.cancel,l=null==a?void 0:a.flush,m=null==a?void 0:a.readableType,n=null==a?void 0:a.start,o=null==a?void 0:a.transform,p=null==a?void 0:a.writableType;return{cancel:void 0===k?void 0:(c=k,d=a,J(c,`${b} has member 'cancel' that`),a=>s(c,d,[a])),flush:void 0===l?void 0:(e=l,f=a,J(e,`${b} has member 'flush' that`),a=>s(e,f,[a])),readableType:m,start:void 0===n?void 0:(g=n,h=a,J(g,`${b} has member 'start' that`),a=>r(g,h,[a])),transform:void 0===o?void 0:(i=o,j=a,J(i,`${b} has member 'transform' that`),(a,b)=>s(i,j,[a,b])),writableType:p}}(a,"First parameter");if(void 0!==g.readableType)throw RangeError("Invalid readableType specified");if(void 0!==g.writableType)throw RangeError("Invalid writableType specified");let h=a0(f,0),i=a1(f),o=a0(e,1),p=a1(e);(function(a,b,c,d,e,f){function g(){return b}a._writable=function(a,b,c,d,e=1,f=()=>1){let g=Object.create(a5.prototype);return a6(g),bq(g,Object.create(bo.prototype),a,b,c,d,e,f),g}(g,function(b){var c=a,d=b;let e=c._transformStreamController;return c._backpressure?m(c._backpressureChangePromise,()=>{let a=c._writable;if("erroring"===a._state)throw a._storedError;return co(e,d)},void 0):co(e,d)},function(){var b=a;let c=b._transformStreamController;if(void 0!==c._finishPromise)return c._finishPromise;let d=b._readable;c._finishPromise=k((a,b)=>{c._finishPromise_resolve=a,c._finishPromise_reject=b});let e=c._flushAlgorithm();return cm(c),n(e,()=>("errored"===d._state?cr(c,d._storedError):(bP(d._readableStreamController),cq(c)),null),a=>(bR(d._readableStreamController,a),cr(c,a),null)),c._finishPromise},function(b){var c=a,d=b;let e=c._transformStreamController;if(void 0!==e._finishPromise)return e._finishPromise;let f=c._readable;e._finishPromise=k((a,b)=>{e._finishPromise_resolve=a,e._finishPromise_reject=b});let g=e._cancelAlgorithm(d);return cm(e),n(g,()=>("errored"===f._state?cr(e,f._storedError):(bR(f._readableStreamController,d),cq(e)),null),a=>(bR(f._readableStreamController,a),cr(e,a),null)),e._finishPromise},c,d),a._readable=bY(g,function(){var b;return cj(b=a,!1),b._backpressureChangePromise},function(b){var c=a,d=b;let e=c._transformStreamController;if(void 0!==e._finishPromise)return e._finishPromise;let f=c._writable;e._finishPromise=k((a,b)=>{e._finishPromise_resolve=a,e._finishPromise_reject=b});let g=e._cancelAlgorithm(d);return cm(e),n(g,()=>("errored"===f._state?cr(e,f._storedError):(bu(f._writableStreamController,d),ci(c),cq(e)),null),a=>(bu(f._writableStreamController,a),ci(c),cr(e,a),null)),e._finishPromise},e,f),a._backpressure=void 0,a._backpressureChangePromise=void 0,a._backpressureChangePromise_resolve=void 0,cj(a,!0),a._transformStreamController=void 0})(this,k(a=>{d=a}),o,p,h,i),function(a,b){let c,d,e,f=Object.create(ck.prototype);c=void 0!==b.transform?a=>b.transform(a,f):a=>{try{return cn(f,a),l(void 0)}catch(a){return j(a)}},d=void 0!==b.flush?()=>b.flush(f):()=>l(void 0),e=void 0!==b.cancel?a=>b.cancel(a):()=>l(void 0),f._controlledTransformStream=a,a._transformStreamController=f,f._transformAlgorithm=c,f._flushAlgorithm=d,f._cancelAlgorithm=e,f._finishPromise=void 0,f._finishPromise_resolve=void 0,f._finishPromise_reject=void 0}(this,g),void 0!==g.start?d(g.start(this._transformStreamController)):d(void 0)}get readable(){if(!cf(this))throw cs("readable");return this._readable}get writable(){if(!cf(this))throw cs("writable");return this._writable}}function cf(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_transformStreamController")&&a instanceof ce}function cg(a,b){bR(a._readable._readableStreamController,b),ch(a,b)}function ch(a,b){cm(a._transformStreamController),bu(a._writable._writableStreamController,b),ci(a)}function ci(a){a._backpressure&&cj(a,!1)}function cj(a,b){void 0!==a._backpressureChangePromise&&a._backpressureChangePromise_resolve(),a._backpressureChangePromise=k(b=>{a._backpressureChangePromise_resolve=b}),a._backpressure=b}Object.defineProperties(ce.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(ce.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});class ck{constructor(){throw TypeError("Illegal constructor")}get desiredSize(){if(!cl(this))throw cp("desiredSize");return bS(this._controlledTransformStream._readable._readableStreamController)}enqueue(a){if(!cl(this))throw cp("enqueue");cn(this,a)}error(a){var b,c;if(!cl(this))throw cp("error");b=this,c=a,cg(b._controlledTransformStream,c)}terminate(){if(!cl(this))throw cp("terminate");var a=this;let b=a._controlledTransformStream;bP(b._readable._readableStreamController),ch(b,TypeError("TransformStream terminated"))}}function cl(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_controlledTransformStream")&&a instanceof ck}function cm(a){a._transformAlgorithm=void 0,a._flushAlgorithm=void 0,a._cancelAlgorithm=void 0}function cn(a,b){let c=a._controlledTransformStream,d=c._readable._readableStreamController;if(!bT(d))throw TypeError("Readable side is not in a state that permits enqueue");try{bQ(d,b)}catch(a){throw ch(c,a),c._readable._storedError}!bN(d)!==c._backpressure&&cj(c,!0)}function co(a,b){return m(a._transformAlgorithm(b),void 0,b=>{throw cg(a._controlledTransformStream,b),b})}function cp(a){return TypeError(`TransformStreamDefaultController.prototype.${a} can only be used on a TransformStreamDefaultController`)}function cq(a){void 0!==a._finishPromise_resolve&&(a._finishPromise_resolve(),a._finishPromise_resolve=void 0,a._finishPromise_reject=void 0)}function cr(a,b){void 0!==a._finishPromise_reject&&(p(a._finishPromise),a._finishPromise_reject(b),a._finishPromise_resolve=void 0,a._finishPromise_reject=void 0)}function cs(a){return TypeError(`TransformStream.prototype.${a} can only be used on a TransformStream`)}Object.defineProperties(ck.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),g(ck.prototype.enqueue,"enqueue"),g(ck.prototype.error,"error"),g(ck.prototype.terminate,"terminate"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(ck.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0}),a.ByteLengthQueuingStrategy=b7,a.CountQueuingStrategy=cb,a.ReadableByteStreamController=ar,a.ReadableStream=bX,a.ReadableStreamBYOBReader=aX,a.ReadableStreamBYOBRequest=aq,a.ReadableStreamDefaultController=bK,a.ReadableStreamDefaultReader=V,a.TransformStream=ce,a.TransformStreamDefaultController=ck,a.WritableStream=a5,a.WritableStreamDefaultController=bo,a.WritableStreamDefaultWriter=bh})(b)},55511:a=>{"use strict";a.exports=require("crypto")},55591:a=>{"use strict";a.exports=require("https")},56801:a=>{"use strict";a.exports=require("import-in-the-middle")},57075:a=>{"use strict";a.exports=require("node:stream")},57975:a=>{"use strict";a.exports=require("node:util")},59763:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{"0003d7f45df6b0b2c347e50905a79d29b926511e1e":()=>f.Py,"000dfd53c4721cf168a183b555463cdab51ffc4ed1":()=>g.Y,"0034589f1d2c92edff2f19ec9e5169b8c3565c0b42":()=>h.checkAnthropicAuthStatus,"0039a1e3ec94903f5077a271cdc32b6c2192503e65":()=>g.checkGeminiAuthStatus,"003dd1b9c20057c153c65ec693a8a97c2c7d397eca":()=>j.qP,"005b2ec189c601d30b3df1adc4360f25a60dd8dbd1":()=>h.Kq,"00948724e8a95dfc24e8d7117dd457eaa9651d723f":()=>h.E7,"0095dfe489c3eaad7529f40a37395096a069b66e3b":()=>f.rQ,"00a7100f947beb90bd3082dbd5c930d5716643ac07":()=>f.eI,"00acc255a7e44f1734aa61c59a2231460df24f546a":()=>j.Mj,"00cf4af6b7e1f535bfe7ecd2c6a6aa78f002b326e6":()=>g.w,"00f231cf88b395ee3f4c50240213ddbdcc5723fc65":()=>f.checkClaudeCodeAuthStatus,"401e69c7e1809d2449520ff8df986a48bb13c93a0f":()=>j.Pr,"402198ebbdb6d7e3c17323a757408c9e544b496572":()=>k.iG,"4021e7b541e8c44d26dcbdd7fcb30c83dbea2b65e6":()=>k.cJ,"4035158beacacd8f1ef4b2be75cbd9f18d69991500":()=>k.Uq,"40363dd1b78da43766ad862232474399f5b2a072a0":()=>k.zD,"4073a10a070a673722032c700953d8a7352bd3381a":()=>j.By,"407ef3f27f764e95e7886cb1b63831168a8bf6c3f4":()=>j.iB,"40a8c6212441266f8dc43f8c0b7281811e2ca61c99":()=>j.Ht,"40b005237a307bf39bfc65d86e1ff31ae9b009bdf9":()=>f.QX,"40b8e6286f6cc14a5cdc8780d964d6c3e099b1fefd":()=>h.R4,"40dbbdf1812d300ef845d6ae66dd3daf175611184c":()=>j.po,"40de461382855abef981cc6e70a295ed73b537a382":()=>j.aJ,"608b321802ac55e003d268dc05a63910422c87ef53":()=>f.CW,"7f084835d49997b5c29e9620f5eb958bf34cf02ab4":()=>e._S,"7f09648041ecb0430c42cbc749346475a525fd2fde":()=>e.So,"7f0d41fbcdf7518e09631144b14bb8b301e7fecbf7":()=>e.li,"7f0e3a0a48f840160081fefde0484e7f6887aae71a":()=>e.MP,"7f0eb7e08567040e123981941b7622a945afd301ac":()=>e.CZ,"7f1358c89bedecaa95b8e955f23bb7414c892259b1":()=>e.ph,"7f181e7886a63e44af39593a7dbc5008b17da87d46":()=>e.CG,"7f183d9a264ec72d09779d1c2e99b8c9954c39ea41":()=>e.le,"7f1b7fa859bdf8fe8591cdc332b1a6b396e1db1e08":()=>e.pe,"7f23585f8cec888040d6fba2a9b0cae6eedcad69cf":()=>e.Z_,"7f26daf24a35073cb7569ebe2f0cbb793a892c55e5":()=>e.Vn,"7f27c7bb1631d31d5c47725618444728aa80f4e7ff":()=>e.vV,"7f28fb5235eba22da48773b6f6e4d57303ba23c7db":()=>i.B,"7f2bfb2871bed06d56b9a2d972855b04a04459ced7":()=>e.TG,"7f2de477e72e2c61a1b7733099fecf341dea3d8ef4":()=>e.fm,"7f36548ece268a277b9fb34fd0fd2cf01a258fe534":()=>e.I3,"7f43aba9d483155e0ad20ccb5531c132a673fab62b":()=>e.Hu,"7f47427d7bb594561234d530735236a1c839dd6f85":()=>e.Yp,"7f48fd159bf40975d7bc0f59b3c9f843edd6d1dc98":()=>e.iR,"7f4b6239be3aa7c965898ec4f1457281c10c919365":()=>e._R,"7f5274364d6eca0a522a48ab057dc7b9d39ed39077":()=>e.yH,"7f5364fe516a28d543f2b1a09ef09d9c8465d2ef67":()=>e.bm,"7f546cc46b250a21751276880f91ba8b25e9aa4e91":()=>e.UU,"7f5523e34494e6e86309d06ad8627b74d50e2ff977":()=>e._X,"7f56427a42c6766af558ac7e624b6fa31e7841ed68":()=>e.pc,"7f619cd429c1e210dfb653227d83d7577a07a22e1b":()=>e.CA,"7f64a6808436e0b8b611f7604f7857310b3dff1a33":()=>e.x6,"7f665d13a7f45a5199ea0dcf2a0c07217efd365952":()=>e.vK,"7f666dd24828624a04d116dc5559019910fcf97a9e":()=>e.aM,"7f69916ce6742f0401f6451f945365cf68c3c09f4f":()=>l.S,"7f6c3ca904f1c1393de880ffbaed77570437e701c6":()=>e.t2,"7f6d2b86ff783fb073e6ecc3f1631b1cd14116c8da":()=>i.U,"7f7227fe9402c3f6b7d905fe5745a596b759177585":()=>e.XQ,"7f727ec0d8e902e37153ca2489bf13fd1036cd40ba":()=>e.ju,"7f748974eef238b257c55b3a3137fe0da02063f031":()=>e.JP,"7f76a6fb9f4915a42e617a80a89cccffd73d2136aa":()=>e.s_,"7f807c3efdddf54362e84f291c97738bae25bbc50f":()=>e.S_,"7f82add85ad1a3df7deca5ae0d22d19232508a0aee":()=>e.hq,"7f8560df730cc063d52ab34cfc44e26d0427b602c7":()=>e.lG,"7f869be42d9020112eb9b393461ebd2601548b461c":()=>e.o0,"7f8afbcb9e392ff446d9e771201365597bd6b26c52":()=>e.Jw,"7f8ca92a751b6acd41b01fd044f1a0d186401dd02d":()=>e.m_,"7f947bf7fef3b8622e480a4f223045c744e717852f":()=>e.iJ,"7fa192ec39e8f6c86d971cd50352054adebf9839fb":()=>e.Ww,"7fa21df10624c07ab46ce6579fa6f605408dd0f41f":()=>e.wt,"7fa3acb68a81943614e9efd0a8dee9335a66e22435":()=>e.vk,"7fa4fd00e813f942be5d4cd3d1fd5b0d8c99212f81":()=>e.vR,"7fa5487b09e390c75b4354fa3b0ce2b645be131f8c":()=>e.Ct,"7fa8140a6a5d3f1bfa7042c8941eed7af8439c446d":()=>e._f,"7fa90cc5cafe987e8c9e133c7d3615c20f66668f71":()=>e.Bj,"7fbb6ebaac77356de461c52de30eb3c5c5d1c6ad83":()=>e.DH,"7fbdbc80d788a3aa429f9c13092a6a3853dba047b3":()=>e.vE,"7fc4f503e419a4955a2a1069d1f27e6289f7f9459f":()=>e.RK,"7fc6ccd797d64d30e31ccbc2cd7d26b2517a046823":()=>e.Tq,"7fd47c9526e2c6d9c25a7f88337a7cee0bce67c93e":()=>e.gv,"7fd84ab43ae4b320ce07cae5e52688d5b5a4ba858a":()=>e.zU,"7fdb7bed8327c62516773058587d3be630d23dd16a":()=>e._P,"7fe04a25a2dc831d5df7f9cd662ced378e4e27e325":()=>e.BN,"7fe50372c385183e089528e562d6ec79e73736e83e":()=>e.Dk,"7fe6155be1d7ae6670b51506541b20023f2da8e574":()=>e.gn,"7ff13fad020713272943059defb2575db5c94aef36":()=>e.IO,"7ff699ad3539da41142dddf0f6779ac3bd0def8e27":()=>e.WP,"7ffe586dbf65b4c299749ddb04b194455dfecfd32f":()=>e.AX});var e=c(43084),f=c(80346),g=c(49091),h=c(5998),i=c(69342),j=c(6160),k=c(37704),l=c(35829),m=a([e,f,g,h,i,j,k,l]);[e,f,g,h,i,j,k,l]=m.then?(await m)():m,d()}catch(a){d(a)}})},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66936:(a,b,c)=>{"use strict";c.d(b,{R:()=>d});class d extends Response{constructor(a,b){super(a,{...b,status:200,headers:{"Content-Type":"text/plain; charset=utf-8","X-Experimental-Stream-Data":"false",...b?.headers}})}}},73024:a=>{"use strict";a.exports=require("node:fs")},73294:(a,b,c)=>{"use strict";let d,e,f,g,h,i,j,k;c.d(b,{Ay:()=>bT});var l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G={};c.r(G),c.d(G,{xX:()=>aT,qA:()=>aU,LG:()=>aR,cH:()=>aS,pJ:()=>aQ,v3:()=>aW,v7:()=>aV,fK:()=>aZ,PO:()=>a0,m_:()=>aY,Ll:()=>aX,OE:()=>a_,Is:()=>a$});let H="0.12.8",I=!1;var J=c(27910),K=c(81630),L=c(79551),M=c(70236),N=c(55591),O=c(74075);let P=J.Readable,Q=Symbol("buffer"),R=Symbol("type");class S{constructor(){this[R]="";let a=arguments[0],b=arguments[1],c=[];if(a){let b=Number(a.length);for(let d=0;d<b;d++){let b,e=a[d];(b=e instanceof Buffer?e:ArrayBuffer.isView(e)?Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?Buffer.from(e):e instanceof S?e[Q]:Buffer.from("string"==typeof e?e:String(e))).length,c.push(b)}}this[Q]=Buffer.concat(c);let d=b&&void 0!==b.type&&String(b.type).toLowerCase();d&&!/[^\u0020-\u007E]/.test(d)&&(this[R]=d)}get size(){return this[Q].length}get type(){return this[R]}text(){return Promise.resolve(this[Q].toString())}arrayBuffer(){let a=this[Q];return Promise.resolve(a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength))}stream(){let a=new P;return a._read=function(){},a.push(this[Q]),a.push(null),a}toString(){return"[object Blob]"}slice(){let a,b=this.size,c=arguments[0],d=arguments[1];a=void 0===c?0:c<0?Math.max(b+c,0):Math.min(c,b);let e=Math.max((void 0===d?b:d<0?Math.max(b+d,0):Math.min(d,b))-a,0),f=this[Q].slice(a,a+e),g=new S([],{type:arguments[2]});return g[Q]=f,g}}function T(a,b,c){Error.call(this,a),this.message=a,this.type=b,c&&(this.code=this.errno=c.code),Error.captureStackTrace(this,this.constructor)}Object.defineProperties(S.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(S.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),T.prototype=Object.create(Error.prototype),T.prototype.constructor=T,T.prototype.name="FetchError";try{d=require("encoding").convert}catch(a){}let U=Symbol("Body internals"),V=J.PassThrough;function W(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=c.size,e=c.timeout;null==a?a=null:Y(a)?a=Buffer.from(a.toString()):Z(a)||Buffer.isBuffer(a)||("[object ArrayBuffer]"===Object.prototype.toString.call(a)?a=Buffer.from(a):ArrayBuffer.isView(a)?a=Buffer.from(a.buffer,a.byteOffset,a.byteLength):a instanceof J||(a=Buffer.from(String(a)))),this[U]={body:a,disturbed:!1,error:null},this.size=void 0===d?0:d,this.timeout=void 0===e?0:e,a instanceof J&&a.on("error",function(a){let c="AbortError"===a.name?a:new T(`Invalid response body while trying to fetch ${b.url}: ${a.message}`,"system",a);b[U].error=c})}function X(){var a=this;if(this[U].disturbed)return W.Promise.reject(TypeError(`body used already for: ${this.url}`));if(this[U].disturbed=!0,this[U].error)return W.Promise.reject(this[U].error);let b=this.body;if(null===b)return W.Promise.resolve(Buffer.alloc(0));if(Z(b)&&(b=b.stream()),Buffer.isBuffer(b))return W.Promise.resolve(b);if(!(b instanceof J))return W.Promise.resolve(Buffer.alloc(0));let c=[],d=0,e=!1;return new W.Promise(function(f,g){let h;a.timeout&&(h=setTimeout(function(){e=!0,g(new T(`Response timeout while trying to fetch ${a.url} (over ${a.timeout}ms)`,"body-timeout"))},a.timeout)),b.on("error",function(b){"AbortError"===b.name?(e=!0,g(b)):g(new T(`Invalid response body while trying to fetch ${a.url}: ${b.message}`,"system",b))}),b.on("data",function(b){if(!e&&null!==b){if(a.size&&d+b.length>a.size){e=!0,g(new T(`content size at ${a.url} over limit: ${a.size}`,"max-size"));return}d+=b.length,c.push(b)}}),b.on("end",function(){if(!e){clearTimeout(h);try{f(Buffer.concat(c,d))}catch(b){g(new T(`Could not create Buffer from response body for ${a.url}: ${b.message}`,"system",b))}}})})}function Y(a){return"object"==typeof a&&"function"==typeof a.append&&"function"==typeof a.delete&&"function"==typeof a.get&&"function"==typeof a.getAll&&"function"==typeof a.has&&"function"==typeof a.set&&("URLSearchParams"===a.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(a)||"function"==typeof a.sort)}function Z(a){return"object"==typeof a&&"function"==typeof a.arrayBuffer&&"string"==typeof a.type&&"function"==typeof a.stream&&"function"==typeof a.constructor&&"string"==typeof a.constructor.name&&/^(Blob|File)$/.test(a.constructor.name)&&/^(Blob|File)$/.test(a[Symbol.toStringTag])}function $(a){let b,c,d=a.body;if(a.bodyUsed)throw Error("cannot clone body after it is used");return d instanceof J&&"function"!=typeof d.getBoundary&&(b=new V,c=new V,d.pipe(b),d.pipe(c),a[U].body=b,d=c),d}function _(a){if(null===a)return null;if("string"==typeof a)return"text/plain;charset=UTF-8";if(Y(a))return"application/x-www-form-urlencoded;charset=UTF-8";if(Z(a))return a.type||null;if(Buffer.isBuffer(a))return null;else if("[object ArrayBuffer]"===Object.prototype.toString.call(a))return null;else if(ArrayBuffer.isView(a))return null;else if("function"==typeof a.getBoundary)return`multipart/form-data;boundary=${a.getBoundary()}`;else if(a instanceof J)return null;else return"text/plain;charset=UTF-8"}function aa(a){let b=a.body;return null===b?0:Z(b)?b.size:Buffer.isBuffer(b)?b.length:b&&"function"==typeof b.getLengthSync?b._lengthRetrievers&&0==b._lengthRetrievers.length||b.hasKnownLength&&b.hasKnownLength()?b.getLengthSync():null:null}W.prototype={get body(){return this[U].body},get bodyUsed(){return this[U].disturbed},arrayBuffer(){return X.call(this).then(function(a){return a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)})},blob(){let a=this.headers&&this.headers.get("content-type")||"";return X.call(this).then(function(b){return Object.assign(new S([],{type:a.toLowerCase()}),{[Q]:b})})},json(){var a=this;return X.call(this).then(function(b){try{return JSON.parse(b.toString())}catch(b){return W.Promise.reject(new T(`invalid json response body at ${a.url} reason: ${b.message}`,"invalid-json"))}})},text(){return X.call(this).then(function(a){return a.toString()})},buffer(){return X.call(this)},textConverted(){var a=this;return X.call(this).then(function(b){return function(a,b){let c,e;if("function"!=typeof d)throw Error("The package `encoding` must be installed to use the textConverted() function");let f=b.get("content-type"),g="utf-8";return f&&(c=/charset=([^;]*)/i.exec(f)),e=a.slice(0,1024).toString(),!c&&e&&(c=/<meta.+?charset=(['"])(.+?)\1/i.exec(e)),!c&&e&&(!(c=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(e))&&(c=/<meta[\s]+?content=(['"])(.+?)\1[\s]+?http-equiv=(['"])content-type\3/i.exec(e))&&c.pop(),c&&(c=/charset=(.*)/i.exec(c.pop()))),!c&&e&&(c=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(e)),c&&("gb2312"===(g=c.pop())||"gbk"===g)&&(g="gb18030"),d(a,"UTF-8",g).toString()}(b,a.headers)})}},Object.defineProperties(W.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),W.mixIn=function(a){for(let b of Object.getOwnPropertyNames(W.prototype))if(!(b in a)){let c=Object.getOwnPropertyDescriptor(W.prototype,b);Object.defineProperty(a,b,c)}},W.Promise=global.Promise;let ab=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,ac=/[^\t\x20-\x7e\x80-\xff]/;function ad(a){if(a=`${a}`,ab.test(a)||""===a)throw TypeError(`${a} is not a legal HTTP header name`)}function ae(a){if(a=`${a}`,ac.test(a))throw TypeError(`${a} is not a legal HTTP header value`)}function af(a,b){for(let c in b=b.toLowerCase(),a)if(c.toLowerCase()===b)return c}let ag=Symbol("map");class ah{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[ag]=Object.create(null),a instanceof ah){let b=a.raw();for(let a of Object.keys(b))for(let c of b[a])this.append(a,c);return}if(null==a);else if("object"==typeof a){let b=a[Symbol.iterator];if(null!=b){if("function"!=typeof b)throw TypeError("Header pairs must be iterable");let c=[];for(let b of a){if("object"!=typeof b||"function"!=typeof b[Symbol.iterator])throw TypeError("Each header pair must be iterable");c.push(Array.from(b))}for(let a of c){if(2!==a.length)throw TypeError("Each header pair must be a name/value tuple");this.append(a[0],a[1])}}else for(let b of Object.keys(a)){let c=a[b];this.append(b,c)}}else throw TypeError("Provided initializer must be an object")}get(a){ad(a=`${a}`);let b=af(this[ag],a);return void 0===b?null:this[ag][b].join(", ")}forEach(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,c=ai(this),d=0;for(;d<c.length;){var e=c[d];let f=e[0],g=e[1];a.call(b,g,f,this),c=ai(this),d++}}set(a,b){a=`${a}`,b=`${b}`,ad(a),ae(b);let c=af(this[ag],a);this[ag][void 0!==c?c:a]=[b]}append(a,b){a=`${a}`,b=`${b}`,ad(a),ae(b);let c=af(this[ag],a);void 0!==c?this[ag][c].push(b):this[ag][a]=[b]}has(a){return ad(a=`${a}`),void 0!==af(this[ag],a)}delete(a){ad(a=`${a}`);let b=af(this[ag],a);void 0!==b&&delete this[ag][b]}raw(){return this[ag]}keys(){return ak(this,"key")}values(){return ak(this,"value")}[Symbol.iterator](){return ak(this,"key+value")}}function ai(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";return Object.keys(a[ag]).sort().map("key"===b?function(a){return a.toLowerCase()}:"value"===b?function(b){return a[ag][b].join(", ")}:function(b){return[b.toLowerCase(),a[ag][b].join(", ")]})}ah.prototype.entries=ah.prototype[Symbol.iterator],Object.defineProperty(ah.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(ah.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});let aj=Symbol("internal");function ak(a,b){let c=Object.create(al);return c[aj]={target:a,kind:b,index:0},c}let al=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==al)throw TypeError("Value of `this` is not a HeadersIterator");var a=this[aj];let b=a.target,c=a.kind,d=a.index,e=ai(b,c);return d>=e.length?{value:void 0,done:!0}:(this[aj].index=d+1,{value:e[d],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));Object.defineProperty(al,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});let am=Symbol("Response internals"),an=K.STATUS_CODES;class ao{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};W.call(this,a,b);let c=b.status||200,d=new ah(b.headers);if(null!=a&&!d.has("Content-Type")){let b=_(a);b&&d.append("Content-Type",b)}this[am]={url:b.url,status:c,statusText:b.statusText||an[c],headers:d,counter:b.counter}}get url(){return this[am].url||""}get status(){return this[am].status}get ok(){return this[am].status>=200&&this[am].status<300}get redirected(){return this[am].counter>0}get statusText(){return this[am].statusText}get headers(){return this[am].headers}clone(){return new ao($(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}W.mixIn(ao.prototype),Object.defineProperties(ao.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(ao.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});let ap=Symbol("Request internals"),aq=L.URL||M.URL,ar=L.parse,as=L.format;function at(a){return/^[a-zA-Z][a-zA-Z\d+\-.]*:/.exec(a)&&(a=new aq(a).toString()),ar(a)}let au="destroy"in J.Readable.prototype;function av(a){return"object"==typeof a&&"object"==typeof a[ap]}class aw{constructor(a){let b,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};av(a)?b=at(a.url):(b=a&&a.href?at(a.href):at(`${a}`),a={});let d=c.method||a.method||"GET";if(d=d.toUpperCase(),(null!=c.body||av(a)&&null!==a.body)&&("GET"===d||"HEAD"===d))throw TypeError("Request with GET/HEAD method cannot have body");let e=null!=c.body?c.body:av(a)&&null!==a.body?$(a):null;W.call(this,e,{timeout:c.timeout||a.timeout||0,size:c.size||a.size||0});let f=new ah(c.headers||a.headers||{});if(null!=e&&!f.has("Content-Type")){let a=_(e);a&&f.append("Content-Type",a)}let g=av(a)?a.signal:null;if("signal"in c&&(g=c.signal),null!=g&&!function(a){let b=a&&"object"==typeof a&&Object.getPrototypeOf(a);return!!(b&&"AbortSignal"===b.constructor.name)}(g))throw TypeError("Expected signal to be an instanceof AbortSignal");this[ap]={method:d,redirect:c.redirect||a.redirect||"follow",headers:f,parsedURL:b,signal:g},this.follow=void 0!==c.follow?c.follow:void 0!==a.follow?a.follow:20,this.compress=void 0!==c.compress?c.compress:void 0===a.compress||a.compress,this.counter=c.counter||a.counter||0,this.agent=c.agent||a.agent}get method(){return this[ap].method}get url(){return as(this[ap].parsedURL)}get headers(){return this[ap].headers}get redirect(){return this[ap].redirect}get signal(){return this[ap].signal}clone(){return new aw(this)}}function ax(a){Error.call(this,a),this.type="aborted",this.message=a,Error.captureStackTrace(this,this.constructor)}W.mixIn(aw.prototype),Object.defineProperty(aw.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(aw.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),ax.prototype=Object.create(Error.prototype),ax.prototype.constructor=ax,ax.prototype.name="AbortError";let ay=L.URL||M.URL,az=J.PassThrough,aA=function(a,b){let c=new ay(b).hostname,d=new ay(a).hostname;return c===d||"."===c[c.length-d.length-1]&&c.endsWith(d)};function aB(a,b){if(!aB.Promise)throw Error("native promise missing, set fetch.Promise to your favorite alternative");return W.Promise=aB.Promise,new aB.Promise(function(c,d){var e,f;let g,h,i=new aw(a,b),j=function(a){let b=a[ap].parsedURL,c=new ah(a[ap].headers);if(c.has("Accept")||c.set("Accept","*/*"),!b.protocol||!b.hostname)throw TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(b.protocol))throw TypeError("Only HTTP(S) protocols are supported");if(a.signal&&a.body instanceof J.Readable&&!au)throw Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let d=null;if(null==a.body&&/^(POST|PUT)$/i.test(a.method)&&(d="0"),null!=a.body){let b=aa(a);"number"==typeof b&&(d=String(b))}d&&c.set("Content-Length",d),c.has("User-Agent")||c.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),a.compress&&!c.has("Accept-Encoding")&&c.set("Accept-Encoding","gzip,deflate");let e=a.agent;return"function"==typeof e&&(e=e(b)),Object.assign({},b,{method:a.method,headers:function(a){let b=Object.assign({__proto__:null},a[ag]),c=af(a[ag],"Host");return void 0!==c&&(b[c]=b[c][0]),b}(c),agent:e})}(i),k=("https:"===j.protocol?N:K).request,l=i.signal,m=null,n=function(){let a=new ax("The user aborted a request.");d(a),i.body&&i.body instanceof J.Readable&&aC(i.body,a),m&&m.body&&m.body.emit("error",a)};if(l&&l.aborted)return void n();let o=function(){n(),q()},p=k(j);function q(){p.abort(),l&&l.removeEventListener("abort",o),clearTimeout(g)}l&&l.addEventListener("abort",o),i.timeout&&p.once("socket",function(a){g=setTimeout(function(){d(new T(`network timeout at: ${i.url}`,"request-timeout")),q()},i.timeout)}),p.on("error",function(a){d(new T(`request to ${i.url} failed, reason: ${a.message}`,"system",a)),m&&m.body&&aC(m.body,a),q()}),e=p,f=function(a){(!l||!l.aborted)&&m&&m.body&&aC(m.body,a)},e.on("socket",function(a){h=a}),e.on("response",function(a){let b=a.headers;"chunked"!==b["transfer-encoding"]||b["content-length"]||a.once("close",function(a){if(h&&h.listenerCount("data")>0&&!a){let a=Error("Premature close");a.code="ERR_STREAM_PREMATURE_CLOSE",f(a)}})}),14>parseInt(process.version.substring(1))&&p.on("socket",function(a){a.addListener("close",function(b){let c=a.listenerCount("data")>0;if(m&&c&&!b&&!(l&&l.aborted)){let a=Error("Premature close");a.code="ERR_STREAM_PREMATURE_CLOSE",m.body.emit("error",a)}})}),p.on("response",function(a){clearTimeout(g);let b=function(a){let b=new ah;for(let c of Object.keys(a))if(!ab.test(c))if(Array.isArray(a[c]))for(let d of a[c])ac.test(d)||(void 0===b[ag][c]?b[ag][c]=[d]:b[ag][c].push(d));else ac.test(a[c])||(b[ag][c]=[a[c]]);return b}(a.headers);if(aB.isRedirect(a.statusCode)){let f=b.get("Location"),g=null;try{g=null===f?null:new ay(f,i.url).toString()}catch(a){if("manual"!==i.redirect){d(new T(`uri requested responds with an invalid redirect URL: ${f}`,"invalid-redirect")),q();return}}switch(i.redirect){case"error":d(new T(`uri requested responds with a redirect, redirect mode is set to error: ${i.url}`,"no-redirect")),q();return;case"manual":if(null!==g)try{b.set("Location",g)}catch(a){d(a)}break;case"follow":var e;if(null===g)break;if(i.counter>=i.follow){d(new T(`maximum redirect reached at: ${i.url}`,"max-redirect")),q();return}let h={headers:new ah(i.headers),follow:i.follow,counter:i.counter+1,agent:i.agent,compress:i.compress,method:i.method,body:i.body,signal:i.signal,timeout:i.timeout,size:i.size};if(!aA(i.url,g)||(e=i.url,new ay(g).protocol!==new ay(e).protocol))for(let a of["authorization","www-authenticate","cookie","cookie2"])h.headers.delete(a);if(303!==a.statusCode&&i.body&&null===aa(i)){d(new T("Cannot follow redirect with body being a readable stream","unsupported-redirect")),q();return}(303===a.statusCode||(301===a.statusCode||302===a.statusCode)&&"POST"===i.method)&&(h.method="GET",h.body=void 0,h.headers.delete("content-length")),c(aB(new aw(g,h))),q();return}}a.once("end",function(){l&&l.removeEventListener("abort",o)});let f=a.pipe(new az),h={url:i.url,status:a.statusCode,statusText:a.statusMessage,headers:b,size:i.size,timeout:i.timeout,counter:i.counter},j=b.get("Content-Encoding");if(!i.compress||"HEAD"===i.method||null===j||204===a.statusCode||304===a.statusCode)return void c(m=new ao(f,h));let k={flush:O.Z_SYNC_FLUSH,finishFlush:O.Z_SYNC_FLUSH};if("gzip"==j||"x-gzip"==j)return void c(m=new ao(f=f.pipe(O.createGunzip(k)),h));if("deflate"==j||"x-deflate"==j){let b=a.pipe(new az);b.once("data",function(a){c(m=new ao(f=(15&a[0])==8?f.pipe(O.createInflate()):f.pipe(O.createInflateRaw()),h))}),b.on("end",function(){m||c(m=new ao(f,h))});return}if("br"==j&&"function"==typeof O.createBrotliDecompress)return void c(m=new ao(f=f.pipe(O.createBrotliDecompress()),h));c(m=new ao(f,h))});let r=i.body;null===r?p.end():Z(r)?r.stream().pipe(p):Buffer.isBuffer(r)?(p.write(r),p.end()):r.pipe(p)})}function aC(a,b){a.destroy?a.destroy(b):(a.emit("error",b),a.end())}aB.isRedirect=function(a){return 301===a||302===a||303===a||307===a||308===a},aB.Promise=global.Promise;var aD=c(70457),aE=c(80235),aF=c(86955),aG=c(73024),aH=c(15202),aI=c(57075);class aJ{constructor(a){this.body=a}get[Symbol.toStringTag](){return"MultipartBody"}}var aK=c(54199);let aL=!1;async function aM(a,...b){let{fileFromPath:d}=await c.e(3517).then(c.bind(c,83517));return aL||(console.warn(`fileFromPath is deprecated; use fs.createReadStream(${JSON.stringify(a)}) instead`),aL=!0),await d(a,...b)}let aN=new aE({keepAlive:!0,timeout:3e5}),aO=new aE.HttpsAgent({keepAlive:!0,timeout:3e5});async function aP(a,b){let c=new aH.Vi(a),d=new aJ(aI.Readable.from(c)),e={...b.headers,...c.headers,"Content-Length":c.contentLength};return{...b,body:d,headers:e}}f||function(a,b={auto:!1}){if(I)throw Error(`you must \`import '@anthropic-ai/sdk/shims/${a.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(f)throw Error(`can't \`import '@anthropic-ai/sdk/shims/${a.kind}'\` after \`import '@anthropic-ai/sdk/shims/${f}'\``);I=b.auto,f=a.kind,g=a.fetch,a.Request,a.Response,a.Headers,a.FormData,a.Blob,h=a.File,i=a.ReadableStream,a.getMultipartRequestOptions,j=a.getDefaultAgent,k=a.fileFromPath,a.isFsReadStream}(("undefined"==typeof AbortController&&(globalThis.AbortController=aF.AbortController),{kind:"node",fetch:aB,Request:aw,Response:ao,Headers:ah,FormData:aD.fS,Blob:aD.YQ,File:aD.ZH,ReadableStream:aK.ReadableStream,getMultipartRequestOptions:aP,getDefaultAgent:a=>a.startsWith("https")?aO:aN,fileFromPath:aM,isFsReadStream:a=>a instanceof aG.ReadStream}),{auto:!0});class aQ extends Error{}class aR extends aQ{constructor(a,b,c,d){super(`${aR.makeMessage(a,b,c)}`),this.status=a,this.headers=d,this.error=b}static makeMessage(a,b,c){let d=b?.message?"string"==typeof b.message?b.message:JSON.stringify(b.message):b?JSON.stringify(b):c;return a&&d?`${a} ${d}`:a?`${a} status code (no body)`:d||"(no status code or body)"}static generate(a,b,c,d){return a?400===a?new aV(a,b,c,d):401===a?new aW(a,b,c,d):403===a?new aX(a,b,c,d):404===a?new aY(a,b,c,d):409===a?new aZ(a,b,c,d):422===a?new a$(a,b,c,d):429===a?new a_(a,b,c,d):a>=500?new a0(a,b,c,d):new aR(a,b,c,d):new aT({cause:bq(b)})}}class aS extends aR{constructor({message:a}={}){super(void 0,void 0,a||"Request was aborted.",void 0),this.status=void 0}}class aT extends aR{constructor({message:a,cause:b}){super(void 0,void 0,a||"Connection error.",void 0),this.status=void 0,b&&(this.cause=b)}}class aU extends aT{constructor({message:a}={}){super({message:a??"Request timed out."})}}class aV extends aR{constructor(){super(...arguments),this.status=400}}class aW extends aR{constructor(){super(...arguments),this.status=401}}class aX extends aR{constructor(){super(...arguments),this.status=403}}class aY extends aR{constructor(){super(...arguments),this.status=404}}class aZ extends aR{constructor(){super(...arguments),this.status=409}}class a$ extends aR{constructor(){super(...arguments),this.status=422}}class a_ extends aR{constructor(){super(...arguments),this.status=429}}class a0 extends aR{}class a1{constructor(a,b){this.iterator=a,this.controller=b}static fromSSEResponse(a,b){let c=!1,d=new a2;async function*e(){if(!a.body)throw b.abort(),new aQ("Attempted to iterate over a response with no body");let c=new a3;for await(let b of a4(a.body))for(let a of c.decode(b)){let b=d.decode(a);b&&(yield b)}for(let a of c.flush()){let b=d.decode(a);b&&(yield b)}}async function*f(){if(c)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");c=!0;let d=!1;try{for await(let b of e()){if("completion"===b.event)try{yield JSON.parse(b.data)}catch(a){throw console.error("Could not parse message into JSON:",b.data),console.error("From chunk:",b.raw),a}if("message_start"===b.event||"message_delta"===b.event||"message_stop"===b.event||"content_block_start"===b.event||"content_block_delta"===b.event||"content_block_stop"===b.event)try{yield JSON.parse(b.data)}catch(a){throw console.error("Could not parse message into JSON:",b.data),console.error("From chunk:",b.raw),a}if("ping"!==b.event&&"error"===b.event){let c=b.data,d=bl(c),e=d?void 0:c;throw aR.generate(void 0,d,e,bh(a.headers))}}d=!0}catch(a){if(a instanceof Error&&"AbortError"===a.name)return;throw a}finally{d||b.abort()}}return new a1(f,b)}static fromReadableStream(a,b){let c=!1;async function*d(){let b=new a3;for await(let c of a4(a))for(let a of b.decode(c))yield a;for(let a of b.flush())yield a}return new a1(async function*(){if(c)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");c=!0;let a=!1;try{for await(let b of d())!a&&b&&(yield JSON.parse(b));a=!0}catch(a){if(a instanceof Error&&"AbortError"===a.name)return;throw a}finally{a||b.abort()}},b)}[Symbol.asyncIterator](){return this.iterator()}tee(){let a=[],b=[],c=this.iterator(),d=d=>({next:()=>{if(0===d.length){let d=c.next();a.push(d),b.push(d)}return d.shift()}});return[new a1(()=>d(a),this.controller),new a1(()=>d(b),this.controller)]}toReadableStream(){let a,b=this,c=new TextEncoder;return new i({async start(){a=b[Symbol.asyncIterator]()},async pull(b){try{let{value:d,done:e}=await a.next();if(e)return b.close();let f=c.encode(JSON.stringify(d)+"\n");b.enqueue(f)}catch(a){b.error(a)}},async cancel(){await a.return?.()}})}}class a2{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(a){if(a.endsWith("\r")&&(a=a.substring(0,a.length-1)),!a){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(a),a.startsWith(":"))return null;let[b,c,d]=function(a,b){let c=a.indexOf(":");return -1!==c?[a.substring(0,c),b,a.substring(c+b.length)]:[a,"",""]}(a,":");return d.startsWith(" ")&&(d=d.substring(1)),"event"===b?this.event=d:"data"===b&&this.data.push(d),null}}class a3{constructor(){this.buffer=[],this.trailingCR=!1}decode(a){let b=this.decodeText(a);if(this.trailingCR&&(b="\r"+b,this.trailingCR=!1),b.endsWith("\r")&&(this.trailingCR=!0,b=b.slice(0,-1)),!b)return[];let c=a3.NEWLINE_CHARS.has(b[b.length-1]||""),d=b.split(a3.NEWLINE_REGEXP);return 1!==d.length||c?(this.buffer.length>0&&(d=[this.buffer.join("")+d[0],...d.slice(1)],this.buffer=[]),c||(this.buffer=[d.pop()||""]),d):(this.buffer.push(d[0]),[])}decodeText(a){if(null==a)return"";if("string"==typeof a)return a;if("undefined"!=typeof Buffer){if(a instanceof Buffer)return a.toString();if(a instanceof Uint8Array)return Buffer.from(a).toString();throw new aQ(`Unexpected: received non-Uint8Array (${a.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(a instanceof Uint8Array||a instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(a);throw new aQ(`Unexpected: received non-Uint8Array/ArrayBuffer (${a.constructor.name}) in a web platform. Please report this error.`)}throw new aQ("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let a=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,a}}function a4(a){if(a[Symbol.asyncIterator])return a;let b=a.getReader();return{async next(){try{let a=await b.read();return a?.done&&b.releaseLock(),a}catch(a){throw b.releaseLock(),a}},async return(){let a=b.cancel();return b.releaseLock(),await a,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}a3.NEWLINE_CHARS=new Set(["\n","\r","\v","\f","\x1c","\x1d","\x1e","\x85","\u2028","\u2029"]),a3.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;let a5=a=>null!=a&&"object"==typeof a&&"string"==typeof a.url&&"function"==typeof a.blob,a6=a=>null!=a&&"object"==typeof a&&"number"==typeof a.size&&"string"==typeof a.type&&"function"==typeof a.text&&"function"==typeof a.slice&&"function"==typeof a.arrayBuffer;async function a7(a,b,c={}){var d;if(a5(a=await a)){let d=await a.blob();return b||(b=new URL(a.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new h([d],b,c)}let e=await a8(a);if(b||(b=(a9((d=a).name)||a9(d.filename)||a9(d.path)?.split(/[\\/]/).pop())??"unknown_file"),!c.type){let a=e[0]?.type;"string"==typeof a&&(c={...c,type:a})}return new h(e,b,c)}async function a8(a){let b=[];if("string"==typeof a||ArrayBuffer.isView(a)||a instanceof ArrayBuffer)b.push(a);else if(a6(a))b.push(await a.arrayBuffer());else if(ba(a))for await(let c of a)b.push(c);else throw Error(`Unexpected data type: ${typeof a}; constructor: ${a?.constructor?.name}; props: ${function(a){let b=Object.getOwnPropertyNames(a);return`[${b.map(a=>`"${a}"`).join(", ")}]`}(a)}`);return b}let a9=a=>"string"==typeof a?a:"undefined"!=typeof Buffer&&a instanceof Buffer?String(a):void 0,ba=a=>null!=a&&"object"==typeof a&&"function"==typeof a[Symbol.asyncIterator],bb=a=>a&&"object"==typeof a&&a.body&&"MultipartBody"===a[Symbol.toStringTag],bc=a=>{if((a=>(a=>null!=a&&"object"==typeof a&&"string"==typeof a.name&&"number"==typeof a.lastModified&&a6(a))(a)||a5(a)||isFsReadStream(a))(a))return!0;if(Array.isArray(a))return a.some(bc);if(a&&"object"==typeof a){for(let b in a)if(bc(a[b]))return!0}return!1};async function bd(a){let{response:b}=a;if(a.options.stream)return(bu("response",b.status,b.url,b.headers,b.body),a.options.__streamClass)?a.options.__streamClass.fromSSEResponse(b,a.controller):a1.fromSSEResponse(b,a.controller);if(204===b.status)return null;if(a.options.__binaryResponse)return b;let c=b.headers.get("content-type");if(c?.includes("application/json")){let a=await b.json();return bu("response",b.status,b.url,b.headers,a),a}let d=await b.text();return bu("response",b.status,b.url,b.headers,d),d}class be extends Promise{constructor(a,b=bd){super(a=>{a(null)}),this.responsePromise=a,this.parseResponse=b}_thenUnwrap(a){return new be(this.responsePromise,async b=>a(await this.parseResponse(b)))}asResponse(){return this.responsePromise.then(a=>a.response)}async withResponse(){let[a,b]=await Promise.all([this.parse(),this.asResponse()]);return{data:a,response:b}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(a,b){return this.parse().then(a,b)}catch(a){return this.parse().catch(a)}finally(a){return this.parse().finally(a)}}class bf{constructor({baseURL:a,maxRetries:b=2,timeout:c=6e5,httpAgent:d,fetch:e}){this.baseURL=a,this.maxRetries=bp("maxRetries",b),this.timeout=bp("timeout",c),this.httpAgent=d,this.fetch=e??g}authHeaders(a){return{}}defaultHeaders(a){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...bk(),...this.authHeaders(a)}}validateHeaders(a,b){}defaultIdempotencyKey(){return`stainless-node-retry-${bv()}`}get(a,b){return this.methodRequest("get",a,b)}post(a,b){return this.methodRequest("post",a,b)}patch(a,b){return this.methodRequest("patch",a,b)}put(a,b){return this.methodRequest("put",a,b)}delete(a,b){return this.methodRequest("delete",a,b)}methodRequest(a,b,c){return this.request(Promise.resolve(c).then(c=>({method:a,path:b,...c})))}getAPIList(a,b,c){return this.requestAPIList(b,{method:"get",path:a,...c})}calculateContentLength(a){if("string"==typeof a){if("undefined"!=typeof Buffer)return Buffer.byteLength(a,"utf8").toString();if("undefined"!=typeof TextEncoder)return new TextEncoder().encode(a).length.toString()}return null}buildRequest(a){let{method:b,path:c,query:d,headers:e={}}=a,f=bb(a.body)?a.body.body:a.body?JSON.stringify(a.body,null,2):null,g=this.calculateContentLength(f),h=this.buildURL(c,d);"timeout"in a&&bp("timeout",a.timeout);let i=a.timeout??this.timeout,k=a.httpAgent??this.httpAgent??j(h),l=i+1e3;"number"==typeof k?.options?.timeout&&l>(k.options.timeout??0)&&(k.options.timeout=l),this.idempotencyHeader&&"get"!==b&&(a.idempotencyKey||(a.idempotencyKey=this.defaultIdempotencyKey()),e[this.idempotencyHeader]=a.idempotencyKey);let m=this.buildHeaders({options:a,headers:e,contentLength:g});return{req:{method:b,...f&&{body:f},headers:m,...k&&{agent:k},signal:a.signal??null},url:h,timeout:i}}buildHeaders({options:a,headers:b,contentLength:c}){let d={};return c&&(d["content-length"]=c),bt(d,this.defaultHeaders(a)),bt(d,b),bb(a.body)&&"node"!==f&&delete d["content-type"],this.validateHeaders(d,b),d}async prepareOptions(a){}async prepareRequest(a,{url:b,options:c}){}parseHeaders(a){return a?Symbol.iterator in a?Object.fromEntries(Array.from(a).map(a=>[...a])):{...a}:{}}makeStatusError(a,b,c,d){return aR.generate(a,b,c,d)}request(a,b=null){return new be(this.makeRequest(a,b))}async makeRequest(a,b){let c=await a;null==b&&(b=c.maxRetries??this.maxRetries),await this.prepareOptions(c);let{req:d,url:e,timeout:f}=this.buildRequest(c);if(await this.prepareRequest(d,{url:e,options:c}),bu("request",e,c,d.headers),c.signal?.aborted)throw new aS;let g=new AbortController,h=await this.fetchWithTimeout(e,d,f,g).catch(bq);if(h instanceof Error){if(c.signal?.aborted)throw new aS;if(b)return this.retryRequest(c,b);if("AbortError"===h.name)throw new aU;throw new aT({cause:h})}let i=bh(h.headers);if(!h.ok){if(b&&this.shouldRetry(h)){let a=`retrying, ${b} attempts remaining`;return bu(`response (error; ${a})`,h.status,e,i),this.retryRequest(c,b,i)}let a=await h.text().catch(a=>bq(a).message),d=bl(a),f=d?void 0:a,g=b?"(error; no more retries left)":"(error; not retryable)";throw bu(`response (error; ${g})`,h.status,e,i,f),this.makeStatusError(h.status,d,f,i)}return{response:h,options:c,controller:g}}requestAPIList(a,b){return new bg(this,this.makeRequest(b,null),a)}buildURL(a,b){let c=new URL(bn(a)?a:this.baseURL+(this.baseURL.endsWith("/")&&a.startsWith("/")?a.slice(1):a)),d=this.defaultQuery();return bs(d)||(b={...d,...b}),"object"==typeof b&&b&&!Array.isArray(b)&&(c.search=this.stringifyQuery(b)),c.toString()}stringifyQuery(a){return Object.entries(a).filter(([a,b])=>void 0!==b).map(([a,b])=>{if("string"==typeof b||"number"==typeof b||"boolean"==typeof b)return`${encodeURIComponent(a)}=${encodeURIComponent(b)}`;if(null===b)return`${encodeURIComponent(a)}=`;throw new aQ(`Cannot stringify type ${typeof b}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(a,b,c,d){let{signal:e,...f}=b||{};e&&e.addEventListener("abort",()=>d.abort());let g=setTimeout(()=>d.abort(),c);return this.getRequestClient().fetch.call(void 0,a,{signal:d.signal,...f}).finally(()=>{clearTimeout(g)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(a){let b=a.headers.get("x-should-retry");return"true"===b||"false"!==b&&(408===a.status||409===a.status||429===a.status||!!(a.status>=500))}async retryRequest(a,b,c){let d,e=c?.["retry-after-ms"];if(e){let a=parseFloat(e);Number.isNaN(a)||(d=a)}let f=c?.["retry-after"];if(f&&!d){let a=parseFloat(f);d=Number.isNaN(a)?Date.parse(f)-Date.now():1e3*a}if(!(d&&0<=d&&d<6e4)){let c=a.maxRetries??this.maxRetries;d=this.calculateDefaultRetryTimeoutMillis(b,c)}return await bo(d),this.makeRequest(a,b-1)}calculateDefaultRetryTimeoutMillis(a,b){return Math.min(.5*Math.pow(2,b-a),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${H}`}}new WeakMap,Symbol.asyncIterator;class bg extends be{constructor(a,b,c){super(b,async b=>new c(a,b.response,await bd(b),b.options))}async *[Symbol.asyncIterator](){for await(let a of(await this))yield a}}let bh=a=>new Proxy(Object.fromEntries(a.entries()),{get(a,b){let c=b.toString();return a[c.toLowerCase()]||a[c]}}),bi=a=>"x32"===a?"x32":"x86_64"===a||"x64"===a?"x64":"arm"===a?"arm":"aarch64"===a||"arm64"===a?"arm64":a?`other:${a}`:"unknown",bj=a=>(a=a.toLowerCase()).includes("ios")?"iOS":"android"===a?"Android":"darwin"===a?"MacOS":"win32"===a?"Windows":"freebsd"===a?"FreeBSD":"openbsd"===a?"OpenBSD":"linux"===a?"Linux":a?`Other:${a}`:"Unknown",bk=()=>e??(e=(()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":H,"X-Stainless-OS":bj(Deno.build.os),"X-Stainless-Arch":bi(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":H,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":H,"X-Stainless-OS":bj(process.platform),"X-Stainless-Arch":bi(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let a=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:a,pattern:b}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let c=b.exec(navigator.userAgent);if(c){let b=c[1]||0,d=c[2]||0,e=c[3]||0;return{browser:a,version:`${b}.${d}.${e}`}}}return null}();return a?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":H,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${a.browser}`,"X-Stainless-Runtime-Version":a.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":H,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),bl=a=>{try{return JSON.parse(a)}catch(a){return}},bm=RegExp("^(?:[a-z]+:)?//","i"),bn=a=>bm.test(a),bo=a=>new Promise(b=>setTimeout(b,a)),bp=(a,b)=>{if("number"!=typeof b||!Number.isInteger(b))throw new aQ(`${a} must be an integer`);if(b<0)throw new aQ(`${a} must be a positive integer`);return b},bq=a=>a instanceof Error?a:Error(a),br=a=>"undefined"!=typeof process?process.env?.[a]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(a)?.trim():void 0;function bs(a){if(!a)return!0;for(let b in a)return!1;return!0}function bt(a,b){for(let c in b){if(!Object.prototype.hasOwnProperty.call(b,c))continue;let d=c.toLowerCase();if(!d)continue;let e=b[c];null===e?delete a[d]:void 0!==e&&(a[d]=e)}}function bu(a,...b){"undefined"!=typeof process&&"true"===process.env.DEBUG&&console.log(`Anthropic:DEBUG:${a}`,...b)}let bv=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,a=>{let b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)});class bw{constructor(a){this._client=a}}class bx extends bw{create(a,b){return this._client.post("/v1/complete",{body:a,timeout:6e5,...b,stream:a.stream??!1})}}bx||(bx={});var by=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c},bz=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};class bA{constructor(){l.add(this),this.messages=[],this.receivedMessages=[],m.set(this,void 0),this.controller=new AbortController,n.set(this,void 0),o.set(this,()=>{}),p.set(this,()=>{}),q.set(this,void 0),r.set(this,()=>{}),s.set(this,()=>{}),t.set(this,{}),u.set(this,!1),v.set(this,!1),w.set(this,!1),x.set(this,!1),A.set(this,a=>{if(by(this,v,!0,"f"),a instanceof Error&&"AbortError"===a.name&&(a=new aS),a instanceof aS)return by(this,w,!0,"f"),this._emit("abort",a);if(a instanceof aQ)return this._emit("error",a);if(a instanceof Error){let b=new aQ(a.message);return b.cause=a,this._emit("error",b)}return this._emit("error",new aQ(String(a)))}),by(this,n,new Promise((a,b)=>{by(this,o,a,"f"),by(this,p,b,"f")}),"f"),by(this,q,new Promise((a,b)=>{by(this,r,a,"f"),by(this,s,b,"f")}),"f"),bz(this,n,"f").catch(()=>{}),bz(this,q,"f").catch(()=>{})}static fromReadableStream(a){let b=new bA;return b._run(()=>b._fromReadableStream(a)),b}static createMessage(a,b,c){let d=new bA;for(let a of b.messages)d._addMessageParam(a);return d._run(()=>d._createMessage(a,{...b,stream:!0},{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}_run(a){a().then(()=>{this._emitFinal(),this._emit("end")},bz(this,A,"f"))}_addMessageParam(a){this.messages.push(a)}_addMessage(a,b=!0){this.receivedMessages.push(a),b&&this._emit("message",a)}async _createMessage(a,b,c){let d=c?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort())),bz(this,l,"m",B).call(this);let e=await a.create({...b,stream:!0},{...c,signal:this.controller.signal});for await(let a of(this._connected(),e))bz(this,l,"m",C).call(this,a);if(e.controller.signal?.aborted)throw new aS;bz(this,l,"m",D).call(this)}_connected(){this.ended||(bz(this,o,"f").call(this),this._emit("connect"))}get ended(){return bz(this,u,"f")}get errored(){return bz(this,v,"f")}get aborted(){return bz(this,w,"f")}abort(){this.controller.abort()}on(a,b){return(bz(this,t,"f")[a]||(bz(this,t,"f")[a]=[])).push({listener:b}),this}off(a,b){let c=bz(this,t,"f")[a];if(!c)return this;let d=c.findIndex(a=>a.listener===b);return d>=0&&c.splice(d,1),this}once(a,b){return(bz(this,t,"f")[a]||(bz(this,t,"f")[a]=[])).push({listener:b,once:!0}),this}emitted(a){return new Promise((b,c)=>{by(this,x,!0,"f"),"error"!==a&&this.once("error",c),this.once(a,b)})}async done(){by(this,x,!0,"f"),await bz(this,q,"f")}get currentMessage(){return bz(this,m,"f")}async finalMessage(){return await this.done(),bz(this,l,"m",y).call(this)}async finalText(){return await this.done(),bz(this,l,"m",z).call(this)}_emit(a,...b){if(bz(this,u,"f"))return;"end"===a&&(by(this,u,!0,"f"),bz(this,r,"f").call(this));let c=bz(this,t,"f")[a];if(c&&(bz(this,t,"f")[a]=c.filter(a=>!a.once),c.forEach(({listener:a})=>a(...b))),"abort"===a){let a=b[0];bz(this,x,"f")||c?.length||Promise.reject(a),bz(this,p,"f").call(this,a),bz(this,s,"f").call(this,a),this._emit("end");return}if("error"===a){let a=b[0];bz(this,x,"f")||c?.length||Promise.reject(a),bz(this,p,"f").call(this,a),bz(this,s,"f").call(this,a),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",bz(this,l,"m",y).call(this))}async _fromReadableStream(a,b){let c=b?.signal;c&&(c.aborted&&this.controller.abort(),c.addEventListener("abort",()=>this.controller.abort())),bz(this,l,"m",B).call(this),this._connected();let d=a1.fromReadableStream(a,this.controller);for await(let a of d)bz(this,l,"m",C).call(this,a);if(d.controller.signal?.aborted)throw new aS;bz(this,l,"m",D).call(this)}[(m=new WeakMap,n=new WeakMap,o=new WeakMap,p=new WeakMap,q=new WeakMap,r=new WeakMap,s=new WeakMap,t=new WeakMap,u=new WeakMap,v=new WeakMap,w=new WeakMap,x=new WeakMap,A=new WeakMap,l=new WeakSet,y=function(){if(0===this.receivedMessages.length)throw new aQ("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},z=function(){if(0===this.receivedMessages.length)throw new aQ("stream ended without producing a Message with role=assistant");let a=this.receivedMessages.at(-1).content.filter(a=>"text"===a.type).map(a=>a.text);if(0===a.length)throw new aQ("stream ended without producing a content block with type=text");return a.join(" ")},B=function(){this.ended||by(this,m,void 0,"f")},C=function(a){if(this.ended)return;let b=bz(this,l,"m",E).call(this,a);switch(this._emit("streamEvent",a,b),a.type){case"content_block_delta":"text_delta"===a.delta.type&&this._emit("text",a.delta.text,b.content.at(-1).text||"");break;case"message_stop":this._addMessageParam(b),this._addMessage(b,!0);break;case"content_block_stop":this._emit("contentBlock",b.content.at(-1));break;case"message_start":by(this,m,b,"f")}},D=function(){if(this.ended)throw new aQ("stream has ended, this shouldn't happen");let a=bz(this,m,"f");if(!a)throw new aQ("request ended without sending any chunks");return by(this,m,void 0,"f"),a},E=function(a){let b=bz(this,m,"f");if("message_start"===a.type){if(b)throw new aQ(`Unexpected event order, got ${a.type} before receiving "message_stop"`);return a.message}if(!b)throw new aQ(`Unexpected event order, got ${a.type} before "message_start"`);switch(a.type){case"message_stop":case"content_block_stop":return b;case"message_delta":return b.stop_reason=a.delta.stop_reason,b.stop_sequence=a.delta.stop_sequence,b;case"content_block_start":return b.content.push(a.content_block),b;case"content_block_delta":{let c=b.content.at(a.index);return c?.type==="text"&&"text_delta"===a.delta.type&&(c.text+=a.delta.text),b}}},Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("streamEvent",c=>{let d=b.shift();d?d(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a(void 0);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise(a=>b.push(a)).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new a1(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class bB extends bw{create(a,b){return this._client.post("/v1/messages",{body:a,timeout:6e5,...b,headers:{"Anthropic-Beta":"messages-2023-12-15",...b?.headers},stream:a.stream??!1})}stream(a,b){return bA.createMessage(this,a,b)}}bB||(bB={});class bC extends bw{constructor(){super(...arguments),this.messages=new bB(this._client)}}(bC||(bC={})).Messages=bB;class bD extends bf{constructor({baseURL:a=br("ANTHROPIC_BASE_URL"),apiKey:b=br("ANTHROPIC_API_KEY")??null,authToken:c=br("ANTHROPIC_AUTH_TOKEN")??null,...d}={}){let e={apiKey:b,authToken:c,...d,baseURL:a||"https://api.anthropic.com"};super({baseURL:e.baseURL,timeout:e.timeout??6e5,httpAgent:e.httpAgent,maxRetries:e.maxRetries,fetch:e.fetch}),this.completions=new bx(this),this.beta=new bC(this),this._options=e,this.apiKey=b,this.authToken=c}defaultQuery(){return this._options.defaultQuery}defaultHeaders(a){return{...super.defaultHeaders(a),"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(a,b){if((!this.apiKey||!a["x-api-key"])&&null!==b["x-api-key"]&&(!this.authToken||!a.authorization)&&null!==b.authorization)throw Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(a){let b=this.apiKeyAuth(a),c=this.bearerAuth(a);return null==b||bs(b)?null==c||bs(c)?{}:c:b}apiKeyAuth(a){return null==this.apiKey?{}:{"X-Api-Key":this.apiKey}}bearerAuth(a){return null==this.authToken?{}:{Authorization:`Bearer ${this.authToken}`}}}F=bD,bD.Anthropic=F,bD.HUMAN_PROMPT="\n\nHuman:",bD.AI_PROMPT="\n\nAssistant:",bD.AnthropicError=aQ,bD.APIError=aR,bD.APIConnectionError=aT,bD.APIConnectionTimeoutError=aU,bD.APIUserAbortError=aS,bD.NotFoundError=aY,bD.ConflictError=aZ,bD.RateLimitError=a_,bD.BadRequestError=aV,bD.AuthenticationError=aW,bD.InternalServerError=a0,bD.PermissionDeniedError=aX,bD.UnprocessableEntityError=a$;let{HUMAN_PROMPT:bE,AI_PROMPT:bF}=bD,{pJ:bG,LG:bH,xX:bI,qA:bJ,cH:bK,m_:bL,fK:bM,OE:bN,v7:bO,v3:bP,PO:bQ,Ll:bR,Is:bS}=G;!function(a){a.toFile=a7,a.fileFromPath=k,a.Completions=bx,a.Beta=bC}(bD||(bD={}));let bT=bD},73566:a=>{"use strict";a.exports=require("worker_threads")},74075:a=>{"use strict";a.exports=require("zlib")},74998:a=>{"use strict";a.exports=require("perf_hooks")},75919:a=>{"use strict";a.exports=require("node:worker_threads")},76760:a=>{"use strict";a.exports=require("node:path")},77030:a=>{"use strict";a.exports=require("node:net")},77598:a=>{"use strict";a.exports=require("node:crypto")},78474:a=>{"use strict";a.exports=require("node:events")},79321:(a,b,c)=>{"use strict";c.d(b,{O:()=>e});var d=c(46663);let e=(a,b)=>(0,d.kN)(b??"gpt-4").encode(a).length??0},79428:a=>{"use strict";a.exports=require("buffer")},79551:a=>{"use strict";a.exports=require("url")},79646:a=>{"use strict";a.exports=require("child_process")},79748:a=>{"use strict";a.exports=require("fs/promises")},80481:a=>{"use strict";a.exports=require("node:readline")},81630:a=>{"use strict";a.exports=require("http")},83997:a=>{"use strict";a.exports=require("tty")},84297:a=>{"use strict";a.exports=require("async_hooks")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},86592:a=>{"use strict";a.exports=require("node:inspector")},88863:(a,b,c)=>{Promise.resolve().then(c.bind(c,66609))},91645:a=>{"use strict";a.exports=require("net")},91912:a=>{"use strict";a.exports=require("better-sqlite3-multiple-ciphers")},94735:a=>{"use strict";a.exports=require("events")}};var b=require("../../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[5879,5009,3999,4931,2949,9291,6663,3155,9489,205,4855,8550,3084,827,7884],()=>b(b.s=21505));module.exports=c})();
//# sourceMappingURL=route.js.map